<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML><HEAD>
<TITLE>Ada 83 LRM, Sec 10.2: Subunits of Compilation Units</TITLE>
</HEAD><BODY>
<hr><a href="ada_lrm.html"><IMG SRC="adass.gif" align=LEFT hspace=6 vspace=6 alt="Lady Ada"></a><H1>Ada '83 Language Reference Manual</H1>
<h6><a href="ada_legal.html">Copyright</a> 1980, 1982, 1983 owned by the United States Government. Direct reproduction and usage requests to the <a href="mailto://adainfo@sw-eng.falls-church.va.us">Ada Information Clearinghouse</a>.</h6>
<br clear=LEFT>
<hr>

<H2><A NAME="10.2">10.2</A>.  Subunits of Compilation Units  </H2>
<A HREF="lrm-10-01.html#10.1"><img src="lrm-prev.gif" alt="[PREVIOUS]"></A><A HREF="lrm-10.html#10"><img src="lrm-up.gif" alt="[UP]"></A><A HREF="lrm-10-03.html#10.3"><img src="lrm-next.gif" alt="[NEXT]"></A>
<P>
A subunit is used for the separate compilation of  the  proper  body  of  a
program  unit  declared  within  another  compilation unit.  This method of
splitting a program permits hierarchical program development. 
<pre>
    body_stub ::=
         subprogram_specification is separate;
       | package body package_simple_name is separate;
       | task body task_simple_name is separate; 

    subunit ::=
         separate (parent_unit_name) proper_body 
</pre>
<P>
A body stub is only allowed as the body of a program unit (a subprogram,  a
package,  a  task  unit,  or  a  generic  unit)  if  the  body  stub occurs  
immediately within either the specification of a  library  package  or  the
declarative part of another compilation unit. 
<P>
If the body of a program unit is a body stub, a separately compiled subunit
containing  the  corresponding  proper  body is required.  In the case of a
subprogram, the subprogram specifications given in the proper body  and  in
the body stub must conform (see <a href="lrm-06-03.html#6.3.1">6.3.1</a>). 
<P>
Each subunit mentions the name of its parent unit, that is, the compilation
unit  where  the corresponding body stub is given.  If the parent unit is a
library unit, it is called the ancestor library unit.  If the  parent  unit
is  itself  a  subunit,  the  parent  unit name must be given in full as an
expanded name, starting with the simple name of the ancestor library  unit.
The  simple  names of all subunits that have the same ancestor library unit
must be distinct identifiers. 
<P>
Visibility within the proper body of a subunit is the visibility that would
be obtained at the place of the corresponding body stub (within the  parent
unit)  if  the with clauses and use clauses of the subunit were appended to
the context clause of the parent unit.  If the  parent  unit  is  itself  a
subunit,  then  the  same  rule is used to define the visibility within the
proper body of the parent unit. 
<P>
The effect of the elaboration of a body stub is  to  elaborate  the  proper
body of the subunit. 
<P>
Notes: 
<P>
Two  subunits  of  different library units in the same program library need
not have distinct identifiers.  In any case, their full expanded names  are
distinct,  since  the  simple names of library units are distinct and since
the simple names of all subunits that have a given library unit as ancestor
unit are also distinct.  By  means  of  renaming  declarations,  overloaded
subprogram names that rename (distinct) subunits can be introduced. 
<P>
A  library unit that is named by the with clause of a subunit can be hidden 
by a declaration (with the same identifier) given in the proper body of the
subunit.  Moreover, such a library unit can even be hidden by a declaration  
given within a parent unit since a library unit  acts  as  if  declared  in
STANDARD;   this  however  does  not  affect the interpretation of the with
clauses themselves, since only names of library units can  appear  in  with
clauses.                                                                           
<P>
<b>References:</b>   <A HREF="lrm-10-01.html#10.1">compilation  unit</A>,
<A HREF="lrm-06-03.html#6.3.1">conform</A>,
<A HREF="lrm-10-01.html#10.1.1">context clause</A>,
<A HREF="lrm-03-01.html#3.1">declaration</A>,
<A HREF="lrm-03-09.html#3.9">declarative part</A>,
<A HREF="lrm-08-03.html#8.3">direct visibility</A>,
<A HREF="lrm-03-09.html#3.9">elaboration</A>,
<A HREF="lrm-04-01.html#4.1.3">expanded  name</A>,
<A HREF="lrm-12-02.html#12.2">generic  body</A>,
<A HREF="lrm-12.html#12">generic unit</A>,
<A HREF="lrm-08-03.html#8.3">hidden declaration</A>,
<A HREF="lrm-02-03.html#2.3">identifier</A>,
<A HREF="lrm-10-01.html#10.1">library unit</A>,
<A HREF="lrm-08-01.html#8.1">local declaration</A>,
<A HREF="lrm-04-01.html#4.1">name</A>,
<A HREF="lrm-08-01.html#8.1">occur immediately within</A>,
<A HREF="lrm-08-03.html#8.3">overloading</A>,
<A HREF="lrm-07.html#7">package</A>,
<A HREF="lrm-07-01.html#7.1">package body</A>,
<A HREF="lrm-07-01.html#7.1">package  specification</A>,
<A HREF="lrm-10.html#10">program</A>,
<A HREF="lrm-06.html#6">program unit</A>,
<A HREF="lrm-03-09.html#3.9">proper body</A>,
<A HREF="lrm-08-05.html#8.5">renaming declaration</A>,
<A HREF="lrm-10-01.html#10.1">separate compilation</A>,
<A HREF="lrm-04-01.html#4.1">simple  name</A>,
<A HREF="lrm-06.html#6">subprogram</A>,
<A HREF="lrm-06-03.html#6.3">subprogram body</A>,
<A HREF="lrm-06-01.html#6.1">subprogram specification</A>,
<A HREF="lrm-09.html#9">task</A>,
<A HREF="lrm-09-01.html#9.1">task body</A>,
<A HREF="lrm-09-01.html#9.1">task unit</A>,
<A HREF="lrm-08-04.html#8.4">use  clause</A>,
<A HREF="lrm-08-03.html#8.3">visibility</A>,
<A HREF="lrm-10-01.html#10.1.1">with clause</A>.
<P>
<b>Style Guide references:</b> 
	<A HREF="http://archive.adaic.com/docs/style-guide/83style/html/sty-04-01.html#4.1.1">4.1.1&nbsp;Separate Compilation Capabilities</a>, 
	<A HREF="http://archive.adaic.com/docs/style-guide/83style/html/sty-04-02.html#4.2.3">4.2.3&nbsp;Restricting Visibility</a>
<p>
<b>Sub-topics:</b>
<ul>
<li><A HREF="#10.2.1">10.2.1</A> Examples of Subunits  
</ul>

<H3><A NAME="10.2.1">10.2.1</A>.  Examples of Subunits  </H3>
<A HREF="#10.2"><img src="lrm-up.gif" alt="[UP]"></A>
<P>
The  procedure TOP is first written as a compilation unit without subunits. 
<pre>
    with TEXT_IO;
    procedure TOP is 

       type REAL is digits 10;
       R, S : REAL := 1.0; 

       package FACILITY is
          PI : constant := 3.14159_26536;
          function  F(X : REAL) return REAL;
          procedure G(Y, Z : REAL);
       end FACILITY; 

       package body FACILITY is
          --  some local declarations followed by  

          function F(X : REAL) return REAL is
          begin
             --  sequence of statements of F
             ...
          end F; 
          procedure G(Y, Z : REAL) is
             --  local procedures using TEXT_IO
             ...
          begin
             --  sequence of statements of G
             ...
          end G;
       end FACILITY; 

       procedure TRANSFORM(U : in out REAL) is
          use FACILITY;
       begin
          U := F(U);
          ...
       end TRANSFORM;
    begin -- TOP  
       TRANSFORM(R);
       ...
       FACILITY.G(R, S);
    end TOP;                                                                          
</pre>
<P>
The body of the package FACILITY and that of the procedure TRANSFORM can be
made into separate subunits of TOP.  Similarly, the body of the procedure G
can be made into a subunit of FACILITY as follows. 
<P>
Example 3: 
<pre>
    procedure TOP is 

       type REAL is digits 10;
       R, S : REAL := 1.0; 

       package FACILITY is
          PI : constant := 3.14159_26536;
          function  F(X : REAL) return REAL;
          procedure G(Y, Z : REAL);
       end FACILITY; 

     package body FACILITY is separate;                 --  stub of FACILITY
     procedure TRANSFORM(U : in out REAL) is separate;  --  stub of TRANSFORM

    begin  --  TOP
       TRANSFORM(R);
       ...
       FACILITY.G(R, S);
    end TOP; 

    ------------------------------------------------- 

    separate (TOP)
    procedure TRANSFORM(U : in out REAL) is
       use FACILITY;
    begin
       U := F(U);
       ...   
    end TRANSFORM; 

    ------------------------------------------------- 

    separate (TOP)
    package body FACILITY is
       --  some local declarations followed by 

       function F(X : REAL) return REAL is
       begin
          --  sequence of statements of F
          ...
       end F; 

       procedure G(Y, Z : REAL) is separate;              -- stub of G
    end FACILITY;                                                                      

    ------------------------------------------------- 

    with TEXT_IO;
    separate (TOP.FACILITY)  --  full name of FACILITY
    procedure G(Y, Z : REAL) is
       --  local procedures using TEXT_IO
       ...
    begin
       --  sequence of statements of G
       ...
    end G; 
</pre>
<P>
In the above example TRANSFORM and FACILITY are subunits of TOP, and G is a
subunit of FACILITY.  The visibility in the split version is the same as in
the initial version except for one change:   since  TEXT_IO  is  only  used
within  G,  the  corresponding  with clause is written for G instead of for
TOP.   Apart  from  this  change,  the  same  identifiers  are  visible  at
corresponding  program points in the two versions.  For example, all of the
following  are (directly) visible within the proper body of the subunit  G:
the  procedure  TOP,  the  type  REAL,  the  variables R and S, the package
FACILITY and the contained named number PI and subprograms F and G. 
<P>
<b>References:</b>  <A HREF="#10.2">body stub</A>,
<A HREF="lrm-10-01.html#10.1">compilation unit</A>,
<A HREF="lrm-02-03.html#2.3">identifier</A>,
<A HREF="lrm-08-01.html#8.1">local declaration</A>,
<A HREF="lrm-03-02.html#3.2">named number</A>,
<A HREF="lrm-07.html#7">package</A>,
<A HREF="lrm-07-01.html#7.1">package body</A>,
<A HREF="lrm-06.html#6">procedure</A>,
<A HREF="lrm-06-03.html#6.3">procedure body</A>,
<A HREF="lrm-03-09.html#3.9">proper body</A>,
<A HREF="lrm-06.html#6">subprogram</A>,
<A HREF="lrm-03-03.html#3.3">type</A>,
<A HREF="lrm-03-02.html#3.2.1">variable</A>,
<A HREF="lrm-08-03.html#8.3">visibility</A>,
<A HREF="lrm-10-01.html#10.1.1">with clause</A>.
<P>


<A HREF="lrm-IDX.html"><img src="lrm-idx.gif" alt="[INDEX]"></A><A HREF="lrm-TOC.html"><img src="lrm-toc.gif" alt="[CONTENTS]"></A>

<hr>
<address><a href="http://sw-eng.falls-church.va.us/AdaIC/"><IMG SRC="small_adaic_logo.gif" ALT="[Ada Information Clearinghouse]"></a><p>
Address any questions or comments to
<A HREF="mailto://adainfo@sw-eng.falls-church.va.us">adainfo@sw-eng.falls-church.va.us</A>.</address>
</BODY></HTML>
