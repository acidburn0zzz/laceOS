<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Timing Events</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 3.4em; margin-bottom: 0.6em}
    UL.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,0,153)"><B>Ada Reference Manual</B></SPAN> &mdash; <A HREF="RM-TTL.html"><B>Legal Information</B></A></DIV>
<DIV Style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-D-14-2.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-E.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<HR>
<H1>D.15 Timing Events</H1>
<DIV Class="paranum">1/2</DIV>
<DIV Class="Normal">This clause describes a language-defined package 
to allow user-defined protected procedures to be executed at a specified 
time without the need for a task or a delay statement.&nbsp;</DIV>

<H4 Class="centered">Static Semantics</H4>
<DIV Class="paranum">2/2</DIV>
<DIV Class="Normal" Style="margin-bottom: 0.4em">The following language-defined 
library package exists:&nbsp;</DIV>
<DIV Class="paranum">3/2</DIV>
<DIV Class="Examples"><B>package</B>&nbsp;Ada.Real_Time.Timing_Events&nbsp;<B>is</B><A NAME="I7041"></A></DIV>
<DIV Class="paranum">4/2</DIV>
<DIV Class="Examples">&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I7042"></A>Timing_Event&nbsp;<B>is&nbsp;tagged&nbsp;limited&nbsp;private</B>;<BR>
&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I7043"></A>Timing_Event_Handler<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>is&nbsp;access&nbsp;protected&nbsp;procedure</B>&nbsp;(Event&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Timing_Event);</DIV>
<DIV Class="paranum">5/2</DIV>
<DIV Class="Examples">&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I7044"></A>Set_Handler&nbsp;(Event&nbsp;&nbsp;&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Timing_Event;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;At_Time&nbsp;:&nbsp;<B>in</B>&nbsp;Time;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handler&nbsp;:&nbsp;<B>in</B>&nbsp;Timing_Event_Handler);<BR>
&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I7045"></A>Set_Handler&nbsp;(Event&nbsp;&nbsp;&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Timing_Event;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In_Time&nbsp;:&nbsp;<B>in</B>&nbsp;Time_Span;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handler&nbsp;:&nbsp;<B>in</B>&nbsp;Timing_Event_Handler);<BR>
&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I7046"></A>Current_Handler&nbsp;(Event&nbsp;:&nbsp;Timing_Event)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;Timing_Event_Handler;<BR>
&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I7047"></A>Cancel_Handler&nbsp;(Event&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Timing_Event;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cancelled&nbsp;:&nbsp;<B>out</B>&nbsp;Boolean);</DIV>
<DIV Class="paranum">6/2</DIV>
<DIV Class="Examples">&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I7048"></A>Time_Of_Event&nbsp;(Event&nbsp;:&nbsp;Timing_Event)&nbsp;<B>return</B>&nbsp;Time;</DIV>
<DIV Class="paranum">7/2</DIV>
<DIV Class="Examples"><B>private</B><BR>
&nbsp;&nbsp;...&nbsp;--&nbsp;<SPAN Class="roman"><I>not&nbsp;specified&nbsp;by&nbsp;the&nbsp;language</I></SPAN><BR>
<B>end</B>&nbsp;Ada.Real_Time.Timing_Events;</DIV>
<DIV Class="paranum">8/2</DIV>
<DIV Class="Normal">The type Timing_Event represents a time in the future 
when an event is to occur. The type Timing_Event needs finalization (see 
<A HREF="RM-7-6.html">7.6</A>).</DIV>
<DIV Class="paranum">9/2</DIV>
<DIV Class="Normal">An object of type Timing_Event is said to be <I>set</I> 
if it is associated with a non-null value of type Timing_Event_Handler 
and <I>cleared</I> otherwise. All Timing_Event objects are initially 
cleared. <A NAME="I7049"></A><A NAME="I7050"></A></DIV>
<DIV Class="paranum">10/2</DIV>
<DIV Class="Normal">&nbsp;The type Timing_Event_Handler identifies a protected 
procedure to be executed by the implementation when the timing event 
occurs. Such a protected procedure is called a <I>handler</I>. <A NAME="I7051"></A></DIV>

<H4 Class="centered">Dynamic Semantics</H4>
<DIV Class="paranum">11/2</DIV>
<DIV Class="Normal">&nbsp;The procedures Set_Handler associate the handler 
Handler with the event Event; if Handler is <B>null</B>, the event is 
cleared, otherwise it is set. The first procedure Set_Handler sets the 
execution time for the event to be At_Time. The second procedure Set_Handler 
sets the execution time for the event to be Real_Time.Clock + In_Time.</DIV>
<DIV Class="paranum">12/2</DIV>
<DIV Class="Normal">&nbsp;A call of a procedure Set_Handler for an event that 
is already set replaces the handler and the time of execution; if Handler 
is not <B>null</B>, the event remains set.</DIV>
<DIV Class="paranum">13/2</DIV>
<DIV Class="Normal">&nbsp;As soon as possible after the time set for the event, 
the handler is executed, passing the event as parameter. The handler 
is only executed if the timing event is in the set state at the time 
of execution. The initial action of the execution of the handler is to 
clear the event.</DIV>
<DIV Class="paranum">14/2</DIV>
<DIV Class="Normal">&nbsp;If the Ceiling_Locking policy (see <A HREF="RM-D-3.html">D.3</A>) 
is in effect when a procedure Set_Handler is called, a check is made 
that the ceiling priority of Handler.<B>all</B> is Interrupt_Priority'Last. 
If the check fails, Program_Error is raised.</DIV>
<DIV Class="paranum">15/2</DIV>
<DIV Class="Normal">&nbsp;If a procedure Set_Handler is called with zero or 
negative In_Time or with At_Time indicating a time in the past then the 
handler is executed immediately by the task executing the call of Set_Handler. 
The timing event Event is cleared.</DIV>
<DIV Class="paranum">16/2</DIV>
<DIV Class="Normal">&nbsp;The function Current_Handler returns the handler 
associated with the event Event if that event is set; otherwise it returns 
<B>null</B>.</DIV>
<DIV Class="paranum">17/2</DIV>
<DIV Class="Normal">&nbsp;The procedure Cancel_Handler clears the event if 
it is set. Cancelled is assigned True if the event was set prior to it 
being cleared; otherwise it is assigned False.</DIV>
<DIV Class="paranum">18/2</DIV>
<DIV Class="Normal">&nbsp;The function Time_Of_Event returns the time of the 
event if the event is set; otherwise it returns Real_Time.Time_First.</DIV>
<DIV Class="paranum">19/2</DIV>
<DIV Class="Normal">&nbsp;As part of the finalization of an object of type 
Timing_Event, the Timing_Event is cleared.</DIV>
<DIV Class="paranum">20/2</DIV>
<DIV Class="Normal">&nbsp;If several timing events are set for the same time, 
they are executed in FIFO order of being set.</DIV>
<DIV Class="paranum">21/2</DIV>
<DIV Class="Normal">&nbsp;An exception propagated from a handler invoked by 
a timing event has no effect.</DIV>

<H4 Class="centered">Implementation Requirements</H4>
<DIV Class="paranum">22/2</DIV>
<DIV Class="Normal">&nbsp;For a given Timing_Event object, the implementation 
shall perform the operations declared in this package atomically with 
respect to any of these operations on the same Timing_Event object. The 
replacement of a handler by a call of Set_Handler shall be performed 
atomically with respect to the execution of the handler.</DIV>

<H4 Class="centered">Metrics</H4>
<DIV Class="paranum">23/2</DIV>
<DIV Class="Normal" Style="margin-bottom: 0.4em">&nbsp;The implementation 
shall document the following metric:&nbsp;</DIV>
<DIV Class="paranum">24/2</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>An upper bound on the lateness of 
the execution of a handler. That is, the maximum time between when a 
handler is actually executed and the time specified when the event was 
set.</LI></UL>

<H4 Class="centered">Implementation Advice</H4>
<DIV Class="paranum">25/2</DIV>
<DIV Class="Normal">&nbsp;The protected handler procedure should be executed 
directly by the real-time clock interrupt mechanism.</DIV>
<DIV Class="NotesHeader">NOTES</DIV>
<DIV Class="paranum">26/2</DIV>
<DIV Class="Notes">45&nbsp;&nbsp;Since a call of Set_Handler is not a 
potentially blocking operation, it can be called from within a handler.</DIV>
<DIV Class="paranum">27/2</DIV>
<DIV Class="Notes">46&nbsp;&nbsp;A Timing_Event_Handler can be associated 
with several Timing_Event objects.</DIV>

<HR>
<DIV Style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-D-14-2.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-E.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
