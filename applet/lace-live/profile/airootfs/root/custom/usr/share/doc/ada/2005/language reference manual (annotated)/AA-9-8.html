<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Abort of a Task - Abort of a Sequence of Statements</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert2 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete2 {text-decoration: line-through; color: rgb(0,102,0) }
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.SyntaxIndented {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-bottom: 0.4em}
    UL.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<DIV Style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-7-4.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-9.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<HR>
<H1>9.8 Abort of a Task - Abort of a Sequence of Statements</H1>
<DIV Class="paranum">1</DIV>
<DIV Class="Normal">[An <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN> 
causes one or more tasks to become abnormal, thus preventing any further 
interaction with such tasks. The completion of the <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0225">triggering_statement</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0223">asynchronous_select</A></SPAN> 
causes a <SPAN Class="swiss"><A HREF="AA-5-1.html#S0130">sequence_of_statements</A></SPAN> 
to be aborted.]&nbsp;</DIV>

<H4 Class="centered">Syntax</H4>
<DIV Class="paranum">2</DIV>
<DIV Class="SyntaxIndented"><SPAN Class="swiss">abort_statement</SPAN><A NAME="I4258"></A><A NAME="S0227"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><B>abort</B>&nbsp;<I>task_</I><A NAME="I4259"></A><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>&nbsp;{,&nbsp;<I>task_</I><A NAME="I4260"></A><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>};</DIV>

<H4 Class="centered">Name Resolution Rules</H4>
<DIV Class="paranum">3</DIV>
<DIV Class="Normal"><SPAN STYLE="font-size: 80%">{<I>expected type (abort_statement 
task_name)</I> [partial]}</SPAN> <A NAME="I4261"></A>Each <I>task_</I><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
is expected to be of any task type[; they need not all be of the same 
task type.]</DIV>

<H4 Class="centered">Dynamic Semantics</H4>
<DIV Class="paranum">4</DIV>
<DIV Class="Normal"><SPAN STYLE="font-size: 80%">{<I>execution (abort_statement)</I> 
[partial]}</SPAN> <A NAME="I4262"></A>For the execution of an <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN>, 
the given <I>task_</I><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN>s 
are evaluated in an arbitrary order. <SPAN STYLE="font-size: 80%">{<I>abort 
(of a task)</I>}</SPAN> <A NAME="I4263"></A><SPAN STYLE="font-size: 80%">{<I>abnormal 
task</I>}</SPAN> <A NAME="I4264"></A><SPAN STYLE="font-size: 80%">{<I>task 
state (abnormal)</I> [partial]}</SPAN> <A NAME="I4265"></A>Each named 
task is then <I>aborted</I>, which consists of making the task <I>abnormal</I> 
and aborting the execution of the corresponding <SPAN Class="swiss"><A HREF="AA-9-1.html#S0192">task_body</A></SPAN>, 
unless it is already completed.&nbsp;</DIV>
<DIV Class="paranum">4.a/2</DIV>
<DIV Class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00114.TXT">AI95-00114-01</A></I>} 
Note that aborting those tasks is not defined to be an abort-deferred 
operation. Therefore, if one of the named tasks is the task executing 
the <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN>, 
or if the task executing the <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN> 
depends on one of the named tasks, then it is possible for the execution 
of the <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN> 
to be aborted, thus leaving some of the tasks unaborted. This allows 
the implementation to use either a sequence of calls to an &ldquo;abort 
task&rdquo; <SPAN class="insert2">run-time system</SPAN><SPAN class="delete2">&nbsp;RTS</SPAN> 
primitive, or a single call to an &ldquo;abort list of tasks&rdquo; <SPAN class="insert2">run-time 
system</SPAN><SPAN class="delete2">&nbsp;RTS</SPAN> primitive.&nbsp;</DIV>
<DIV Class="paranum">5</DIV>
<DIV Class="Normal" Style="margin-bottom: 0.4em"><SPAN STYLE="font-size: 80%">{<I>execution 
(aborting the execution of a construct)</I> [partial]}</SPAN> <A NAME="I4266"></A><SPAN STYLE="font-size: 80%">{<I>abort 
(of the execution of a construct)</I>}</SPAN> <A NAME="I4267"></A>When 
the execution of a construct is <I>aborted</I> (including that of a <SPAN Class="swiss"><A HREF="AA-9-1.html#S0192">task_body</A></SPAN> 
or of a <SPAN Class="swiss"><A HREF="AA-5-1.html#S0130">sequence_of_statements</A></SPAN>), 
the execution of every construct included within the aborted execution 
is also aborted, except for executions included within the execution 
of an <I>abort-deferred</I> operation; the execution of an abort-deferred 
operation continues to completion without being affected by the abort; 
<SPAN STYLE="font-size: 80%">{<I>abort-deferred operation</I>}</SPAN> 
<A NAME="I4268"></A>the following are the abort-deferred operations: 
</DIV>
<DIV Class="paranum">6</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>a protected action;</LI></UL>
<DIV Class="paranum">7</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>waiting for an entry call to complete 
(after having initiated the attempt to cancel it &mdash; see below);</LI></UL>
<DIV Class="paranum">8</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>waiting for the termination of dependent 
tasks;</LI></UL>
<DIV Class="paranum">9</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>the execution of an Initialize procedure 
as the last step of the default initialization of a controlled object;</LI></UL>
<DIV Class="paranum">10</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>the execution of a Finalize procedure 
as part of the finalization of a controlled object;</LI></UL>
<DIV Class="paranum">11</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>an assignment operation to an object 
with a controlled part.&nbsp;</LI></UL>
<DIV Class="paranum">12</DIV>
<DIV Class="Normal">[The last three of these are discussed further in 
<A HREF="AA-7-6.html">7.6</A>.]&nbsp;</DIV>
<DIV Class="paranum">12.a</DIV>
<DIV Class="Annotations"><B>Reason:&nbsp;</B>Deferring abort during Initialize 
and finalization allows, for example, the result of an allocator performed 
in an Initialize operation to be assigned into an access object without 
being interrupted in the middle, which would cause storage leaks. For 
an object with several controlled parts, each individual Initialize is 
abort-deferred. Note that there is generally no semantic difference between 
making each Finalize abort-deferred, versus making a group of them abort-deferred, 
because if the task gets aborted, the first thing it will do is complete 
any remaining finalizations. Individual objects are finalized prior to 
an assignment operation (if nonlimited controlled) and as part of Unchecked_Deallocation. 
</DIV>
<DIV Class="paranum">12.b</DIV>
<DIV Class="Annotations"><B>Ramification:&nbsp;</B>Abort is deferred during 
the entire assignment operation to an object with a controlled part, 
even if only some subcomponents are controlled. Note that this says &quot;assignment 
operation,&quot; not &quot;<SPAN Class="swiss"><A HREF="AA-5-2.html#S0137">assignment_statement</A></SPAN>.&quot; 
Explicit calls to Initialize, Finalize, or Adjust are not abort-deferred. 
</DIV>
<DIV Class="paranum">13</DIV>
<DIV Class="Normal">When a master is aborted, all tasks that depend on 
that master are aborted.</DIV>
<DIV Class="paranum">14</DIV>
<DIV Class="Normal"><SPAN STYLE="font-size: 80%">{<I>unspecified</I> 
[partial]}</SPAN> <A NAME="I4269"></A>The order in which tasks become 
abnormal as the result of an <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN> 
or the abort of a <SPAN Class="swiss"><A HREF="AA-5-1.html#S0130">sequence_of_statements</A></SPAN> 
is not specified by the language.</DIV>
<DIV Class="paranum">15</DIV>
<DIV Class="Normal" Style="margin-bottom: 0.4em">If the execution of 
an entry call is aborted, an immediate attempt is made to cancel the 
entry call (see <A HREF="AA-9-5-3.html">9.5.3</A>). If the execution 
of a construct is aborted at a time when the execution is blocked, other 
than for an entry call, at a point that is outside the execution of an 
abort-deferred operation, then the execution of the construct completes 
immediately. For an abort due to an <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN>, 
these immediate effects occur before the execution of the <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN> 
completes. Other than for these immediate cases, the execution of a construct 
that is aborted does not necessarily complete before the <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN> 
completes. However, the execution of the aborted construct completes 
no later than its next <I>abort completion point</I> (if any) that occurs 
outside of an abort-deferred operation; <SPAN STYLE="font-size: 80%">{<I>abort 
completion point</I>}</SPAN> <A NAME="I4270"></A>the following are abort 
completion points for an execution:&nbsp;</DIV>
<DIV Class="paranum">16</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>the point where the execution initiates 
the activation of another task;</LI></UL>
<DIV Class="paranum">17</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>the end of the activation of a task;</LI></UL>
<DIV Class="paranum">18</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>the start or end of the execution 
of an entry call, <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0201">accept_statement</A></SPAN>, 
<SPAN Class="swiss"><A HREF="AA-9-6.html#S0209">delay_statement</A></SPAN>, 
or <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN>; 
</LI></UL>
<DIV Class="paranum">18.a</DIV>
<DIV Class="Annotations"><B>Ramification:&nbsp;</B>Although the abort completion 
point doesn't occur until the end of the entry call or <SPAN Class="swiss"><A HREF="AA-9-6.html#S0209">delay_statement</A></SPAN>, 
these operations might be cut short because an abort attempts to cancel 
them.&nbsp;</DIV>
<DIV Class="paranum">19</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>the start of the execution of a <SPAN Class="swiss"><A HREF="AA-9-7.html#S0212">select_statement</A></SPAN>, 
or of the <SPAN Class="swiss"><A HREF="AA-5-1.html#S0130">sequence_of_statements</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-11-2.html#S0248">exception_handler</A></SPAN>. 
</LI></UL>
<DIV Class="paranum">19.a</DIV>
<DIV Class="Annotations"><B>Reason:&nbsp;</B>The start of an <SPAN Class="swiss"><A HREF="AA-11-2.html#S0248">exception_handler</A></SPAN> 
is considered an abort completion point simply because it is easy for 
an implementation to check at such points.&nbsp;</DIV>
<DIV Class="paranum">19.b</DIV>
<DIV Class="Annotations"><B>Implementation Note:&nbsp;</B>Implementations 
may of course check for abort more often than at each abort completion 
point; ideally, a fully preemptive implementation of abort will be provided. 
If preemptive abort is not supported in a given environment, then supporting 
the checking for abort as part of subprogram calls and loop iterations 
might be a useful option.&nbsp;</DIV>

<H4 Class="centered">Bounded (Run-Time) Errors</H4>
<DIV Class="paranum">20</DIV>
<DIV Class="Normal"><SPAN STYLE="font-size: 80%">{<I>bounded error (cause)</I> 
[partial]}</SPAN> <A NAME="I4271"></A>An attempt to execute an <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0223">asynchronous_select</A></SPAN> 
as part of the execution of an abort-deferred operation is a bounded 
error. Similarly, an attempt to create a task that depends on a master 
that is included entirely within the execution of an abort-deferred operation 
is a bounded error. <SPAN STYLE="font-size: 80%">{<I>Program_Error (raised 
by failure of run-time check)</I>}</SPAN> <A NAME="I4272"></A>In both 
cases, Program_Error is raised if the error is detected by the implementation; 
otherwise the operations proceed as they would outside an abort-deferred 
operation, except that an abort of the <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0226">abortable_part</A></SPAN> 
or the created task might or might not have an effect.&nbsp;</DIV>
<DIV Class="paranum">20.a</DIV>
<DIV Class="Annotations"><B>Reason:&nbsp;</B>An <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0223">asynchronous_select</A></SPAN> 
relies on an abort of the <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0226">abortable_part</A></SPAN> 
to effect the asynchronous transfer of control. For an <SPAN Class="swiss"><A HREF="AA-9-7-4.html#S0223">asynchronous_select</A></SPAN> 
within an abort-deferred operation, the abort might have no effect.</DIV>
<DIV Class="paranum">20.b</DIV>
<DIV Class="Annotations">Creating a task dependent on a master included 
within an abort-deferred operation is considered an error, because such 
tasks could be aborted while the abort-deferred operation was still progressing, 
undermining the purpose of abort-deferral. Alternatively, we could say 
that such tasks are abort-deferred for their entire execution, but that 
seems too easy to abuse. Note that task creation is already a bounded 
error in protected actions, so this additional rule only applies to local 
task creation as part of Initialize, Finalize, or Adjust.&nbsp;</DIV>

<H4 Class="centered">Erroneous Execution</H4>
<DIV Class="paranum">21</DIV>
<DIV Class="Normal"><SPAN STYLE="font-size: 80%">{<I>normal state of 
an object</I> [partial]}</SPAN> <A NAME="I4273"></A><SPAN STYLE="font-size: 80%">{<I>abnormal 
state of an object</I> [partial]}</SPAN> <A NAME="I4274"></A><SPAN STYLE="font-size: 80%">{<I>disruption 
of an assignment</I>}</SPAN> <A NAME="I4275"></A><SPAN STYLE="font-size: 80%">{<I>erroneous 
execution (cause)</I> [partial]}</SPAN> <A NAME="I4276"></A>If an assignment 
operation completes prematurely due to an abort, the assignment is said 
to be <I>disrupted</I>; the target of the assignment or its parts can 
become abnormal, and certain subsequent uses of the object can be erroneous, 
as explained in <A HREF="AA-13-9-1.html">13.9.1</A>.&nbsp;</DIV>
<DIV Class="NotesHeader">NOTES</DIV>
<DIV Class="paranum">22</DIV>
<DIV Class="Notes">41&nbsp;&nbsp;An <SPAN Class="swiss"><A HREF="AA-9-8.html#S0227">abort_statement</A></SPAN> 
should be used only in situations requiring unconditional termination.</DIV>
<DIV Class="paranum">23</DIV>
<DIV Class="Notes">42&nbsp;&nbsp;A task is allowed to abort any task 
it can name, including itself.</DIV>
<DIV Class="paranum">24</DIV>
<DIV Class="Notes">43&nbsp;&nbsp;Additional requirements associated with 
abort are given in <A HREF="AA-D-6.html">D.6</A>, &ldquo;<A HREF="AA-D-6.html">Preemptive 
Abort</A>&rdquo;.&nbsp;</DIV>

<H4 Class="centered">Wording Changes from Ada 83</H4>
<DIV Class="paranum">24.a</DIV>
<DIV Class="Annotations">This clause has been rewritten to accommodate 
the concept of aborting the execution of a construct, rather than just 
of a task.&nbsp;</DIV>

<HR>
<DIV Style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-7-4.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-9-9.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="font-size: 125%">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
