<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Incompatibilities with Ada 95</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-bottom: 0.6em}
    DIV.SwissExamples {font-family: Arial, Helvetica, sans-serif; font-size: 90%; line-height: 122%; margin-left: 2.2em; margin-bottom: 0.6em}
    </STYLE>
<!-- BEGIN Google Analytics -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-117428-5']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- END Google Analytics -->
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">
<H1 Style='font-family: "Rockwell", "Times New Roman", Times, serif; font-size: 240%'><B><SPAN Style="color:rgb(0,0,153)">Rationale</SPAN> for <SPAN Style="color:rgb(204,0,0)">Ada 2005</SPAN></B></H1>
<DIV Class="Normal"><FONT SIZE="+1"><I><A HREF="Rat-TTL.html">John Barnes</A></I></FONT></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="Rat-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="Rat-0-3.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="Rat-0-2.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="Rat-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="Rat-9-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="Rat-9-1-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>9.1.1 Incompatibilities with Ada 95</H1>
<div class="Normal">Each incompatibility listed below gives the AI concerned 
and the paragraph in the AARM which in some cases will give more information. 
Where relevant, the section in this rationale where the topic is discussed 
is also given. Where appropriate the incompatibilities are grouped together.<A NAME="I1425"></A></div>
<div class="Normal">1 &mdash; The words <B>interface</B>, <B>overriding</B> 
and <B>synchronized</B> are now reserved. Programs using them as identifiers 
will need to be changed. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10284.TXT">AI-284</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-2-9.html">2.9(3.c)</A>)</div>
<div class="Normal">This is perhaps the most important incompatibility 
in terms of visibility to the average programmer. It is discussed in 
<A HREF="Rat-2-2.html">2.2</A>.</div>
<div class="Normal">2 &mdash; If a <A NAME="Item2">predefined</A> package 
has additional entities then incompatibilities can arise. Thus suppose 
the predefined package <SPAN Class="swiss">Ada.Stuff</SPAN> has an additional 
entity <SPAN Class="swiss">More</SPAN> added to it. Then if an Ada 95 
program has a package <SPAN Class="swiss">P</SPAN> containing an entity 
<SPAN Class="swiss">More</SPAN> then a program with a use clause for 
both <SPAN Class="swiss">Ada.Stuff</SPAN> and <SPAN Class="swiss">P</SPAN> 
will become illegal in Ada 2005 because the reference to <SPAN Class="swiss">More</SPAN> 
will become ambiguous. This also applies if further overloadings of an 
existing entity are added.</div>
<div class="Normal">Because of this there has been reluctance to extend 
existing packages but a preference to add child packages. Nevertheless 
in some cases extending a package seemed more appropriate especially 
if the identifiers concerned are unlikely to have been used by programmers.</div>
<div class="Normal">The following packages have been extended with additional 
entities as listed.</div>
<div class="Normal"><SPAN Class="swiss">Ada.Exceptions</SPAN> &mdash; 
<SPAN Class="swiss">Wide_Exception_Name</SPAN>, <SPAN Class="swiss">Wide_Wide_Exception_Name</SPAN>. 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00400.TXT">AI-400</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-11-4-1.html">11.4.1(19.bb)</A>)</div>
<div class="Normal"><SPAN Class="swiss">Ada.Real_Time</SPAN> &mdash; 
<SPAN Class="swiss">Seconds</SPAN>, <SPAN Class="swiss">Minutes</SPAN>. 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00386.TXT">AI-386</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-D-8.html">D.8(51.a)</A>)</div>
<div class="Normal"><SPAN Class="swiss">Ada.Strings</SPAN> &mdash; <SPAN Class="swiss">Wide_Wide_Space</SPAN>. 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00285.TXT">AI-285</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-A-4-1.html">A.4.1(6.a)</A>)</div>
<div class="Normal"><SPAN Class="swiss">Ada.Strings.Fixed</SPAN> &mdash; 
<SPAN Class="swiss">Index</SPAN>, <SPAN Class="swiss">Index_Non_Blank</SPAN>. 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00301.TXT">AI-301</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-A-4-3.html">A.4.3(109.a)</A>)</div>
<div class="Normal"><SPAN Class="swiss">Ada.Strings.Bounded</SPAN> &mdash; 
<SPAN Class="swiss">Set_Bounded_String</SPAN>, <SPAN Class="swiss">Bounded_Slice</SPAN>, 
<SPAN Class="swiss">Index</SPAN>, <SPAN Class="swiss">Index_Non_Blank</SPAN>. 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00301.TXT">AI-301</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-A-4-4.html">A.4.4(106.f)</A>)</div>
<div class="Normal"><SPAN Class="swiss">Ada.Strings.Unbounded</SPAN> 
&mdash; <SPAN Class="swiss">Set_Unbounded_String</SPAN>, <SPAN Class="swiss">Unbounded_Slice</SPAN>, 
<SPAN Class="swiss">Index</SPAN>, <SPAN Class="swiss">Index_Non_Blank</SPAN>. 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00301.TXT">AI-301</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-A-4-5.html">A.4.5(88.c)</A>)</div>
<div class="Normal">There are similar additions to <SPAN Class="swiss">Ada.Strings.Wide_Fixed</SPAN>, 
<SPAN Class="swiss">Ada.Strings.Wide_Bounded</SPAN> and <SPAN Class="swiss">Ada.Strings.Wide_Unbounded</SPAN>. 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00301.TXT">AI-301</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-A-4-7.html">A.4.7(48.a)</A>)</div>
<div class="Normal"><SPAN Class="swiss">Ada.Tags</SPAN> &mdash; <SPAN Class="swiss">No_Tag</SPAN>, 
<SPAN Class="swiss">Parent_Tag</SPAN>, <SPAN Class="swiss">Interface_Ancestor_Tags</SPAN>, 
<SPAN Class="swiss">Descendant_Tag</SPAN>, <SPAN Class="swiss">Is_Descendant_ 
At_Same_Level</SPAN>, <SPAN Class="swiss">Wide_Expanded_Name</SPAN>, 
<SPAN Class="swiss">Wide_Wide_Expanded_Name</SPAN>. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10260.TXT">AI-260</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00344.TXT">AI-344</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00400.TXT">AI-400</A>, 
<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00405.TXT">AI-405</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-3-9.html">3.9(33.d)</A>)</div>
<div class="Normal"><SPAN Class="swiss">Ada.Text_IO</SPAN> &mdash; <SPAN Class="swiss">Get_Line</SPAN>. 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00301.TXT">AI-301</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-A-10-7.html">A.10.7(26.a)</A>)</div>
<div class="Normal"><SPAN Class="swiss">Interfaces.C</SPAN> &mdash; <SPAN Class="swiss">char16_t</SPAN>, 
<SPAN Class="swiss">char32_t</SPAN> and related types and operations. 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00285.TXT">AI-285</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-B-3.html">B.3(84.a)</A>)</div>
<div class="Normal">It seems unlikely that existing programs will be 
affected by these potential incompatibilities.</div>
<div class="Normal">3 &mdash; If a subprogram has an access parameter 
(without a null exclusion) and is not a dispatching operation then it 
cannot be renamed as a dispatching operation in Ada 2005 although it 
can be so renamed in Ada 95. See <A HREF="Rat-3-2.html">3.2</A> for an 
example. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00404.TXT">AI-404</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-3-9-2.html">3.9.2(24.b)</A>)</div>
<div class="Normal">4 &mdash; As discussed in <A HREF="Rat-3-5.html">3.5</A>, 
there are many awkward situations in Ada 95 regarding access types, discriminants 
and constraints. One problem is that some components can change shape 
or disappear. The rules in Ada generally aim to prevent such components 
from being accessed or renamed. However, in Ada 95, some entities don't 
look constrained but actually are constrained. The consequence is that 
it is difficult to prevent some constrained objects from having their 
constraints changed and this can cause components to change or disappear 
even though they might be accessed or renamed. <A NAME="I1426"></A><A NAME="I1427"></A></div>
<div class="Normal">A key rule in Ada 95 was that aliased variables were 
always constrained with the intent that that would solve the problems. 
But loopholes remained and so the rules have been changed considerably. 
Aliased variables are not necessarily constrained in Ada 2005 and other 
rules now disallow certain constructions that were permitted in Ada 95 
and this gives rise to a number of minor incompatibilities.</div>
<div class="Normal" style="margin-bottom: 0.4em">If a general access 
subtype refers to a type with default discriminants then that access 
subtype cannot have constraints in Ada 2005. Consider&nbsp;</div>
<div class="SwissExamples"><B>type</B>&nbsp;T(Disc:&nbsp;Boolean&nbsp;:=&nbsp;False)&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>record</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<BR>
&nbsp;&nbsp;&nbsp;<B>end&nbsp;record</B>;</div>
<div class="Normal" style="margin-bottom: 0.4em">The discriminated type 
<SPAN Class="swiss">T</SPAN> has a default and so unconstrained objects 
of type <SPAN Class="swiss">T</SPAN> are mutable. Suppose we now have 
</div>
<div class="SwissExamples"><B>type</B>&nbsp;T_Ptr&nbsp;<B>is&nbsp;access&nbsp;all</B>&nbsp;T;<BR>
<B>subtype</B>&nbsp;Sub_True_T_Ptr&nbsp;<B>is</B>&nbsp;T_Ptr(Disc&nbsp;=&gt;&nbsp;True);&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>subtype&nbsp;illegal&nbsp;in&nbsp;Ada&nbsp;2005</I></SPAN></div>
<div class="Normal" style="margin-bottom: 0.4em">The type <SPAN Class="swiss">T_Ptr</SPAN> 
is legal in both Ada 95 and Ada 2005 of course, but the subtype <SPAN Class="swiss">Sub_True_T_Ptr</SPAN> 
is only legal in Ada 95 and not in Ada 2005. The reason why the subtype 
cannot be permitted is illustrated by the following&nbsp;</div>
<div class="SwissExamples">Some_T:&nbsp;<B>aliased</B>&nbsp;T&nbsp;:=&nbsp;(Disc&nbsp;=&gt;&nbsp;True,&nbsp;...);<BR>
A_True_T:&nbsp;Sub_True_T_Ptr&nbsp;:=&nbsp;Some_T'Access;<BR>
...<BR>
Some_T&nbsp;:=&nbsp;(Disc&nbsp;=&gt;&nbsp;False,&nbsp;...);</div>
<div class="Normal">When <SPAN Class="swiss">Some_T'Access</SPAN> is 
evaluated there is a check that the discriminant has the correct value 
so that <SPAN Class="swiss">A_True_T</SPAN> is assigned a valid value. 
But the second assignment to <SPAN Class="swiss">Some_T</SPAN> means 
that the discriminant changes and so <SPAN Class="swiss">A_True_T</SPAN> 
would no longer have a valid value.</div>
<div class="Normal">In Ada 95, all aliased variables were considered 
constrained and so the second assignment would not have been permitted 
anyway. But, as mentioned above, aliased variables are not considered 
to be constrained in Ada 2005 just because they are aliased.</div>
<div class="Normal" style="margin-bottom: 0.4em">Note that there is 
no similar restriction on types; thus we can still write&nbsp;</div>
<div class="SwissExamples"><B>type</B>&nbsp;True_T_Ptr&nbsp;<B>is&nbsp;access&nbsp;all</B>&nbsp;T(Disc&nbsp;=&gt;&nbsp;True);</div>
<div class="Normal">because any conversion which might cause difficulties 
is forbidden as explained in one of the examples below.</div>
<div class="Normal">The restriction on subtypes does not apply if the 
discriminants do not have defaults, nor to pool-specific types. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00363.TXT">AI-363</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-3-7-1.html">3.7.1(15.c)</A>)</div>
<div class="Normal" style="margin-bottom: 0.4em">Since aliased variables 
are not necessarily constrained in Ada 2005 there are situations where 
components might change shape or disappear in Ada 2005 that could not 
happen in Ada 95. Applying the <SPAN Class="swiss">Access</SPAN> attribute 
to such components is thus illegal in Ada 2005. Suppose the example above 
has components as follows&nbsp;</div>
<div class="SwissExamples"><B>type</B>&nbsp;T(Disc:&nbsp;Boolean&nbsp;:=&nbsp;False)&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>record</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>case</B>&nbsp;Disc&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>when</B>&nbsp;False&nbsp;=&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comp:&nbsp;<B>aliased</B>&nbsp;Integer;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>when</B>&nbsp;True&nbsp;=&gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>null</B>;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>end&nbsp;case</B>;<BR>
&nbsp;&nbsp;&nbsp;<B>end&nbsp;record</B>;</div>
<div class="Normal"><A NAME="Item4">Since</A> objects of type <SPAN Class="swiss">T</SPAN> 
might be mutable, the component <SPAN Class="swiss">Comp</SPAN> might 
disappear.</div>
<div class="SwissExamples"><B>type</B>&nbsp;Int_Ptr&nbsp;<B>is&nbsp;access&nbsp;all</B>&nbsp;Integer;<BR>
Obj:&nbsp;<B>aliased</B>&nbsp;T;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>mutable&nbsp;object</I></SPAN><BR>
Dodgy:&nbsp;Int_Ptr&nbsp;:=&nbsp;Obj.Comp'Access;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>take&nbsp;care</I></SPAN><BR>
...<BR>
Obj:=&nbsp;(Disc&nbsp;=&gt;&nbsp;True);&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>Comp&nbsp;gone</I></SPAN></div>
<div class="Normal">In Ada 95, the assignment to <SPAN Class="swiss">Dodgy</SPAN> 
is permitted but then the assignment to <SPAN Class="swiss">Obj</SPAN> 
raises <SPAN Class="swiss">Constraint_Error</SPAN> because there might 
be dodgy pointers.</div>
<div class="Normal">In Ada 2005, the assignment statement to <SPAN Class="swiss">Dodgy</SPAN> 
is illegal since we cannot write <SPAN Class="swiss">Obj.Comp'Access</SPAN>. 
The assignment to <SPAN Class="swiss">Obj</SPAN> is itself permitted 
because we now know that there cannot be any dodgy pointers.</div>
<div class="Normal">See (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00363.TXT">AI-363</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-3-10-2.html">3.10.2(41.b)</A>). 
Similarly, renaming an aliased component such as <SPAN Class="swiss">Comp</SPAN> 
is also illegal. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00363.TXT">AI-363</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-8-5-1.html">8.5.1(8.b)</A>)</div>
<div class="Normal" style="margin-bottom: 0.4em">There are related situations 
regarding discriminated private types where type conversions and the 
<SPAN Class="swiss">Access</SPAN> attribute are forbidden. Suppose we 
have a private type and an access type and that the full type is in fact 
the discriminated type above thus&nbsp;</div>
<div class="SwissExamples"><B>package</B>&nbsp;P&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;T&nbsp;<B>is&nbsp;private</B>;<BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;T_Ptr&nbsp;<B>is&nbsp;access&nbsp;all&nbsp;</B>T;<BR>
&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;Evil&nbsp;<B>return</B>&nbsp;T_Ptr;<BR>
&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;Flip(Obj:&nbsp;T)&nbsp;<B>return</B>&nbsp;T;<BR>
<B>private</B><BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;T(Disc:&nbsp;Boolean&nbsp;:=&nbsp;False)&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>record</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>end&nbsp;record</B>;<BR>
&nbsp;&nbsp;&nbsp;...<BR>
<B>end</B>&nbsp;P;</div>
<div class="SwissExamples"><B>package&nbsp;body</B>&nbsp;P&nbsp;<B>is</B></div>
<div class="SwissExamples">&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;True_T_Ptr&nbsp;<B>is&nbsp;access&nbsp;all</B>&nbsp;T(Disc&nbsp;=&gt;&nbsp;True);<BR>
&nbsp;&nbsp;&nbsp;<B>subtype</B>&nbsp;Sub_True_T_Ptr&nbsp;<B>is</B>&nbsp;T_Ptr(Disc&nbsp;=&gt;&nbsp;True);&nbsp;&nbsp;--<SPAN Class="roman"><I>legal&nbsp;in&nbsp;Ada&nbsp;95,&nbsp;illegal&nbsp;in&nbsp;Ada&nbsp;2005</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;True_Obj:&nbsp;<B>aliased</B>&nbsp;T(Disc&nbsp;=&gt;&nbsp;True);<BR>
&nbsp;&nbsp;&nbsp;TTP:&nbsp;True_T_Ptr&nbsp;:=&nbsp;True_Obj'Access;<BR>
&nbsp;&nbsp;&nbsp;STTP:&nbsp;Sub_True_T_Ptr&nbsp;:=&nbsp;True_Obj'Access;</div>
<div class="SwissExamples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;Evil&nbsp;<B>return</B>&nbsp;T_Ptr&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>begin</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>if</B>&nbsp;...&nbsp;<B>then</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;T_Ptr(TTP);&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>OK&nbsp;in&nbsp;95,&nbsp;not&nbsp;in&nbsp;Ada&nbsp;2005</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>elsif</B>&nbsp;...&nbsp;<B>then</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;True_Obj'Access;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>OK&nbsp;in&nbsp;95,&nbsp;not&nbsp;in&nbsp;Ada&nbsp;2005</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>else</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;STTP;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>end&nbsp;if</B>;<BR>
&nbsp;&nbsp;&nbsp;<B>end</B>&nbsp;Evil;</div>
<div class="SwissExamples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;Flip(Obj:&nbsp;T)&nbsp;<B>return</B>&nbsp;T&nbsp;is<BR>
&nbsp;&nbsp;&nbsp;<B>begin</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>case</B>&nbsp;Obj.Disc&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>when</B>&nbsp;True&nbsp;=&gt;&nbsp;<B>return</B>&nbsp;(Disc&nbsp;=&gt;&nbsp;False,&nbsp;...);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>when</B>&nbsp;False&nbsp;=&gt;&nbsp;<B>return</B>&nbsp;(Disc&nbsp;=&gt;&nbsp;True,&nbsp;...);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>end&nbsp;case</B>;<BR>
&nbsp;&nbsp;&nbsp;<B>end</B>&nbsp;Flip;</div>
<div class="SwissExamples"><B>end</B>&nbsp;P;</div>
<div class="Normal" style="margin-bottom: 0.4em">The function <SPAN Class="swiss">Evil</SPAN> 
has three branches illustrating various possible ways of returning a 
value of the type <SPAN Class="swiss">T</SPAN>. The function <SPAN Class="swiss">Flip</SPAN> 
just returns a value of the type <SPAN Class="swiss">T</SPAN> with opposite 
discriminants to the parameter. Now consider&nbsp;</div>
<div class="SwissExamples"><B>with</B>&nbsp;P;&nbsp;&nbsp;<B>use</B>&nbsp;P;<BR>
<B>procedure</B>&nbsp;Do_It&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;A:&nbsp;T;<BR>
&nbsp;&nbsp;&nbsp;B:&nbsp;T_Ptr&nbsp;:=&nbsp;<B>new</B>&nbsp;T;<BR>
&nbsp;&nbsp;&nbsp;C:&nbsp;T_Ptr&nbsp;:=&nbsp;Evil;<BR>
<B>begin</B><BR>
&nbsp;&nbsp;&nbsp;A&nbsp;:=&nbsp;Flip(A);<BR>
&nbsp;&nbsp;&nbsp;B.<B>all</B>&nbsp;:=&nbsp;Flip(B.<B>all</B>);<BR>
&nbsp;&nbsp;&nbsp;C.<B>all</B>&nbsp;:=&nbsp;Flip(C.<B>all</B>);<BR>
<B>end</B>&nbsp;Do_It;</div>
<div class="Normal">This declares an object <SPAN Class="swiss">A</SPAN> 
of type <SPAN Class="swiss">T</SPAN> and then two objects <SPAN Class="swiss">B</SPAN> 
and <SPAN Class="swiss">C</SPAN> of the access type <SPAN Class="swiss">T_Ptr</SPAN> 
and initializes them in different ways. Finally it attempts to change 
the discriminant of the three objects by calling the function <SPAN Class="swiss">Flip</SPAN>.</div>
<div class="Normal">In Ada 95 all objects on the heap are constrained. 
This means that clients cannot change the discriminants even if they 
do not know that they exist. So the assignment to <SPAN Class="swiss">B.</SPAN><B>all</B> 
raises <SPAN Class="swiss">Constraint_Error</SPAN> since <SPAN Class="swiss">B.</SPAN><B>all</B> 
is on the heap and thus constrained whereas the assignment to <SPAN Class="swiss">A</SPAN> 
is fine since <SPAN Class="swiss">A</SPAN> is not constrained. However, 
from the client's point of view they both really do the same thing and 
so the behaviour is very curious. Remember that the client doesn't know 
about the discriminants and so both operations look the same in the abstract. 
This is unfortunate and breaks privacy which is sinful. There is a similar 
example in <A HREF="Rat-3-5.html">3.5</A> where we try to change Chris 
but do not know that the new value has a beard and this fails because 
Chris is female.</div>
<div class="Normal">To prevent such privacy breaking the rules are changed 
in Ada 2005 so that objects on the heap are unconstrained in this one 
case. So the assignments to <SPAN Class="swiss">B.</SPAN><B>all</B> and 
<SPAN Class="swiss">C.</SPAN><B>all</B> do not have checks on the discriminant. 
As a consequence <SPAN Class="swiss">Evil</SPAN> must not return an object 
which is constrained otherwise the assignment to <SPAN Class="swiss">C</SPAN> 
would result in <SPAN Class="swiss">True_Obj</SPAN> having its discriminant 
turned to <SPAN Class="swiss">False</SPAN>.</div>
<div class="Normal">All three possible branches in <SPAN Class="swiss">Evil</SPAN> 
are prevented in Ada 2005. The conversion in the first branch is forbidden 
and the <SPAN Class="swiss">Access</SPAN> attribute in the second branch 
is forbidden. In the case of the third branch the return itself is acceptable 
in principle because <SPAN Class="swiss">STTP</SPAN> is of the correct 
type. However, this is prevented by the rule mentioned above since the 
subtype <SPAN Class="swiss">Sub_True_T_Ptr</SPAN> is itself forbidden 
and so the object <SPAN Class="swiss">STTP</SPAN> could not be declared 
in the first place.</div>
<div class="Normal">See (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00363.TXT">AI-363</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-3-10-2.html">3.10.2(41.e)</A> 
and <A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-4-6.html">4.6(71.k)</A>).</div>
<div class="Normal" style="margin-bottom: 0.4em">5 &mdash; Aggregates 
of limited types are permitted in Ada 2005 as discussed in <A HREF="Rat-4-5.html">4.5</A>. 
This means that in obscure situations an aggregate might be ambiguous 
in Ada 2005 and thus illegal. Consider&nbsp;</div>
<div class="SwissExamples"><B>type</B>&nbsp;Lim&nbsp;<B>is&nbsp;limited</B><BR>
&nbsp;&nbsp;&nbsp;<B>record</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comp:&nbsp;Integer;<BR>
&nbsp;&nbsp;&nbsp;<B>end&nbsp;record</B>;</div>
<div class="SwissExamples"><B>type</B>&nbsp;Not_Lim&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>record</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comp:&nbsp;Integer;<BR>
&nbsp;&nbsp;&nbsp;<B>end&nbsp;record</B>;</div>
<div class="SwissExamples"><B>procedure</B>&nbsp;P(X:&nbsp;LIm);<BR>
<B>procedure</B>&nbsp;P(X:&nbsp;Not_Lim);</div>
<div class="SwissExamples">P((Comp&nbsp;=&gt;&nbsp;123));&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>illegal&nbsp;in&nbsp;Ada&nbsp;2005</I></SPAN></div>
<div class="Normal">In Ada 95, the aggregate cannot be of a limited type 
and so the type <SPAN Class="swiss">Lim</SPAN> is not considered for 
resolution. But Ada 2005 permits aggregates of limited types and so the 
aggregate is ambiguous. See (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00287.TXT">AI-287</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-4-3.html">4.3(6.e)</A>)</div>
<div class="Normal" style="margin-bottom: 0.4em">Another similar situation 
with limited types and nonlimited types concerns assignment. Again this 
relates to the fact that limitedness is no longer considered for name 
resolution. Consider&nbsp;</div>
<div class="SwissExamples"><B>type</B>&nbsp;Acc_Not_Lim&nbsp;<B>is&nbsp;access</B>&nbsp;Not_Lim;<BR>
<B>function</B>&nbsp;F(X:&nbsp;Integer)&nbsp;<B>return</B>&nbsp;Acc_Not_Lim;<BR>
<B>type</B>&nbsp;Acc_Lim&nbsp;<B>is&nbsp;access</B>&nbsp;Lim;<BR>
<B>function</B>&nbsp;F(X:&nbsp;Integer)&nbsp;<B>return</B>&nbsp;Acc_Lim;<BR>
F(1).<B>all</B>&nbsp;:=&nbsp;F(2).<B>all</B>;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>illegal&nbsp;in&nbsp;Ada&nbsp;2005</I></SPAN></div>
<div class="Normal">In Ada 95, only the first <SPAN Class="swiss">F</SPAN> 
is considered for name resolution and the program is valid. In Ada 2005, 
there is an ambiguity because both functions are considered. Note of 
course that the assignment for the limited function is still illegal 
anyway but the compiler meets the ambiguity first. Clearly this is an 
obscure situation. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00287.TXT">AI-287</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-5-2.html">5.2(28.d)</A>)</div>
<div class="Normal" style="margin-bottom: 0.4em">6 &mdash; Because of 
the changes to the fixed-fixed multiplication and division rules there 
are situations where a legal program in Ada 95 becomes illegal in Ada 
2005. Consider&nbsp;</div>
<div class="SwissExamples"><B>package</B>&nbsp;P&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;My_Fixed&nbsp;<B>is&nbsp;delta</B>&nbsp;...&nbsp;;<BR>
&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;&quot;*&quot;&nbsp;(L,&nbsp;R:&nbsp;My_Fixed)&nbsp;<B>return</B>&nbsp;My_Fixed;<BR>
<B>end</B>&nbsp;P;</div>
<div class="SwissExamples"><B>use</B>&nbsp;P;<BR>
A,&nbsp;B:&nbsp;My_Fixed;<BR>
D:&nbsp;Duration&nbsp;:=&nbsp;A&nbsp;*&nbsp;B;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>illegal&nbsp;in&nbsp;Ada&nbsp;2005</I></SPAN></div>
<div class="Normal">Although this is legal in Ada 95, the new rule in 
Ada 2005 says that if there is a user-defined operation involving the 
type concerned then the predefined operation cannot be used unless there 
is a type conversion or we write <SPAN Class="swiss">Standard.&quot;*&quot;( 
... )</SPAN>.</div>
<div class="Normal" style="margin-bottom: 0.4em">So in Ada 2005 a conversion 
can be used thus&nbsp;</div>
<div class="SwissExamples">D:&nbsp;Duration&nbsp;:=&nbsp;Duration(A&nbsp;*&nbsp;B);</div>
<div class="Normal">See <A HREF="Rat-6-3.html">6.3</A>. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00364.TXT">AI-364</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-4-5-5.html">4.5.5(35.d)</A>)</div>
<div class="Normal">7 &mdash; The concept of return by reference types 
has gone. Instead the user has to explicitly declare a function with 
an anonymous access type as the return type. This only affects functions 
that return an existing limited object such as choosing a task from among 
a pool of tasks. See <A HREF="Rat-4-5.html">4.5</A> for an example. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI-318</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-6-5.html">6.5(27.g)</A>)</div>
<div class="Normal">8 &mdash; There is a very curious situation regarding 
exporting multiple homographs from an instantiation that is now illegal. 
This is a side effect of adding interfaces to the language. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00251.TXT">AI-251</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-8-3.html">8.3(29.s)</A>)</div>
<div class="Normal" style="margin-bottom: 0.4em">9 &mdash; The introduction 
of more forms of access types has changed the rules regarding name resolution. 
Consider the following contrived example&nbsp;</div>
<div class="SwissExamples"><B>type</B>&nbsp;Cacc<B>&nbsp;is&nbsp;access&nbsp;constant</B>&nbsp;Integer;<BR>
<B>procedure</B>&nbsp;Proc(Acc:&nbsp;<B>access</B>&nbsp;Integer);<BR>
<B>procedure</B>&nbsp;Proc(Acc:&nbsp;Cacc);<BR>
List:&nbsp;Cacc&nbsp;:=&nbsp;...&nbsp;;<BR>
...<BR>
Proc(List);&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>illegal&nbsp;in&nbsp;Ada&nbsp;2005</I></SPAN></div>
<div class="Normal">In Ada 95 the call of <SPAN Class="swiss">Proc</SPAN> 
is resolved because the parameters <SPAN Class="swiss">Acc</SPAN> are 
anonymous access to variable in one case and access to constant in the 
other. In Ada 2005, the name resolution rules do not take this into account 
so it becomes ambiguous and thus illegal which is a good thing because 
it is likely that the Ada 95 programmer made a mistake anyway. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00409.TXT">AI-409</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-8-6.html">8.6(34.n)</A>)</div>
<div class="Normal">10 &mdash; In Ada 2005, a procedure call that might 
be an entry is permitted in timed and conditional entry calls. See <A HREF="Rat-5-3.html">5.3</A>. 
In Ada 95, a procedure could not be so used and this fact is used in 
name resolution in Ada 95 but does not apply in Ada 2005. Hence if a 
procedure and an entry have the same profile then an ambiguity can exist 
in Ada 2005. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00345.TXT">AI-345</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-9-7-2.html">9.7.2(7.b)</A>)</div>
<div class="Normal">11 &mdash; It is now illegal to have an allocator 
for an access type with <SPAN Class="swiss">Storage_Size</SPAN> equal 
to zero whereas in Ada 95 it raised <SPAN Class="swiss">Storage_Error</SPAN> 
on execution. It is always better to detect errors at compile time wherever 
possible. The reason for the change is to allow <SPAN Class="swiss">Pure</SPAN> 
units to use access types provided they do not use allocators. If the 
storage size is zero then this is now known at compile time. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00366.TXT">AI-366</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-4-8.html">4.8(20.g)</A>)</div>
<div class="Normal">12 &mdash; The requirement that a partial view with 
available stream attributes be externally streamable can cause an incompatibility 
in extremely rare cases. This incompatibility only applies to units with 
pragma <SPAN Class="swiss">Pure</SPAN>. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00366.TXT">AI-366</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-10-2-1.html">10.2.1(28.e)</A>)</div>
<div class="Normal">13 &mdash; It is now illegal to use an incomplete 
view as a parameter or result of an access to subprogram type or as an 
access parameter of a primitive operation if the completion is deferred 
to the package body. See <A HREF="Rat-4-2.html">4.2</A> for examples. 
(<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00326.TXT">AI-326</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-3-10-1.html">3.10.1(23.h, 
i)</A>)</div>
<div class="Normal">14 &mdash; The specification of <SPAN Class="swiss">System.RPC</SPAN> 
can now be tailored for an implementation by adding further operations 
or by changing the profile of existing operations. If it is tailored 
in this way then an existing program might not compile in Ada 2005. See 
<A HREF="Rat-7-7.html">7.7</A>. (<A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00273.TXT">AI-273</A>, 
<A HREF="http://www.adaic.org/resources/add_content/standards/05aarm/html/AA-E-5.html">E.5(30.a)</A>)</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="Rat-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="Rat-0-3.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="Rat-0-2.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="Rat-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="Rat-9-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="Rat-9-1-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Class="Normal">&copy; 2005, 2006, 2007 John Barnes Informatics.</DIV>
<DIV Class="Normal">Sponsored in part by:</DIV>
<TABLE Summary="Sponsors" Width="710">
<TR><TD VAlign="Top" Width="490">
<SPAN Style="font-family: Arial, Helvetica, sans-serif; font-size: 92%">The <A HREF="http://www.adaic.org/community/">Ada Resource Association</A> and its member companies:</SPAN>
<img src="http://www.adaic.org/resources/images/sponsors/ARA-members-5.gif" alt="ARA Members" usemap="#member-map" border=1>
<map name="member-map">
  <AREA href="http://www.adacore.com/" alt="AdaCore"
          shape="rect"          coords="0,0,222,66">
  <AREA href="http://www.polyspace.com/" alt="Polyspace Technologies"
          shape="rect"          coords="0,66,155,179">
	<AREA href="http://www.sparkada.com/" alt="Praxis Critical Systems"
	         shape="rect"         coords="156,66,295,179">
	<AREA href="http://www-306.ibm.com/software/awdtools/developer/ada/" alt="IBM Rational"
	         shape="rect"         coords="222,0,480,66">
	<AREA href="http://www.sofcheck.com/" alt="Sofcheck"
	         shape="rect"         coords="296,66,480,130">
</map>
<TD Width="220" Align="Center" VAlign="Top">
<SPAN Style="font-family: Arial, Helvetica, sans-serif; font-size: 92%">and &nbsp; <A HREF="http://www.ada-europe.org">Ada-Europe</A>:<BR>
<A HREF="http://www.ada-europe.org"><IMG SRC="AE_logo.gif" ALT="Ada-Europe" Height="200" Border="0"></A></SPAN>
</TABLE>
</BODY>
</HTML>
