<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>The Package Interfaces.C.Strings</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert1 {text-decoration: underline; color: rgb(0,51,51) }
    SPAN.delete1 {text-decoration: line-through; color: rgb(0,51,51) }
    SPAN.insert2 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete2 {text-decoration: line-through; color: rgb(0,102,0) }
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.CodeIndented {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 3.4em; margin-bottom: 0.6em}
    UL.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    UL.CodeIndentedBulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    UL.CodeIndentedNestedBulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 9.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    UL.NotesBulleted {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-right: 2.5em; margin-top: 0em; margin-bottom: 0.5em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<DIV Style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-B-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-B-3-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<HR>
<H1>B.3.1 The Package Interfaces.C.Strings</H1>
<DIV Class="paranum">1</DIV>
<DIV Class="Normal">The package Interfaces.C.Strings declares types and 
subprograms allowing an Ada program to allocate, reference, update, and 
free C-style strings. In particular, the private type chars_ptr corresponds 
to a common use of &ldquo;char *&rdquo; in C programs, and an object 
of this type can be passed to a subprogram to which <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Import(C,...) has been applied, and for which &ldquo;char *&rdquo; is 
the type of the argument of the C function.&nbsp;</DIV>

<H4 Class="centered">Static Semantics</H4>
<DIV Class="paranum">2</DIV>
<DIV Class="Normal" Style="margin-bottom: 0.4em">The library package 
Interfaces.C.Strings has the following declaration:&nbsp;</DIV>
<DIV Class="paranum">3</DIV>
<DIV Class="Examples"><B>package</B>&nbsp;Interfaces.C.Strings&nbsp;<B>is</B><A NAME="I7129"></A><BR>
&nbsp;&nbsp;&nbsp;<B>pragma</B>&nbsp;Preelaborate(Strings);</DIV>
<DIV Class="paranum">4</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I7130"></A>char_array_access&nbsp;<B>is</B>&nbsp;<B>access</B>&nbsp;<B>all</B>&nbsp;char_array;</DIV>
<DIV Class="paranum">5/2</DIV>
<DIV Class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00161.TXT">AI95-00161-01</A></I>} 
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I7131"></A>chars_ptr&nbsp;<B>is</B>&nbsp;<B>private</B>;<SPAN class="insert2"><BR>
&nbsp;&nbsp;&nbsp;<B>pragma</B>&nbsp;Preelaborable_Initialization(chars_ptr);</SPAN></DIV>
<DIV Class="paranum">6/2</DIV>
<DIV Class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00276.TXT">AI95-00276-01</A></I>} 
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I7132"></A>chars_ptr_array&nbsp;<B>is</B>&nbsp;<B>array</B>&nbsp;(size_t&nbsp;<B>range</B>&nbsp;&lt;&gt;)&nbsp;<B>of</B>&nbsp;<SPAN class="insert2"><B>aliased</B>&nbsp;</SPAN>chars_ptr;</DIV>
<DIV Class="paranum">7</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<A NAME="I7133"></A>Null_Ptr&nbsp;:&nbsp;<B>constant</B>&nbsp;chars_ptr;</DIV>
<DIV Class="paranum">8</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I7134"></A>To_Chars_Ptr&nbsp;(Item&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array_access;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nul_Check&nbsp;:&nbsp;<B>in</B>&nbsp;Boolean&nbsp;:=&nbsp;False)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;chars_ptr;</DIV>
<DIV Class="paranum">9</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I7135"></A>New_Char_Array&nbsp;(Chars&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array)&nbsp;<B>return</B>&nbsp;chars_ptr;</DIV>
<DIV Class="paranum">10</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I7136"></A>New_String&nbsp;(Str&nbsp;:&nbsp;<B>in</B>&nbsp;String)&nbsp;<B>return</B>&nbsp;chars_ptr;</DIV>
<DIV Class="paranum">11</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I7137"></A>Free&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;<B>out</B>&nbsp;chars_ptr);</DIV>
<DIV Class="paranum">12</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<A NAME="I7138"></A>Dereference_Error&nbsp;:&nbsp;<B>exception</B>;</DIV>
<DIV Class="paranum">13</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I7139"></A>Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;char_array;</DIV>
<DIV Class="paranum">14</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I7140"></A>Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;&nbsp;Length&nbsp;:&nbsp;<B>in</B>&nbsp;size_t)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;char_array;</DIV>
<DIV Class="paranum">15</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I7141"></A>Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;String;</DIV>
<DIV Class="paranum">16</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I7142"></A>Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;&nbsp;Length&nbsp;:&nbsp;<B>in</B>&nbsp;size_t)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;String;</DIV>
<DIV Class="paranum">17</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I7143"></A>Strlen&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;size_t;</DIV>
<DIV Class="paranum">18</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I7144"></A>Update&nbsp;(Item&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;:&nbsp;<B>in</B>&nbsp;size_t;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chars&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;Boolean&nbsp;:=&nbsp;True);</DIV>
<DIV Class="paranum">19</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I7145"></A>Update&nbsp;(Item&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;:&nbsp;<B>in</B>&nbsp;size_t;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Str&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;String;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;Boolean&nbsp;:=&nbsp;True);</DIV>
<DIV Class="paranum">20</DIV>
<DIV Class="Examples">&nbsp;&nbsp;&nbsp;<A NAME="I7146"></A>Update_Error&nbsp;:&nbsp;<B>exception</B>;</DIV>
<DIV Class="paranum">21</DIV>
<DIV Class="Examples"><B>private</B><BR>
&nbsp;&nbsp;&nbsp;...&nbsp;--&nbsp;<SPAN Class="roman"><I>not&nbsp;specified&nbsp;by&nbsp;the&nbsp;language</I></SPAN><BR>
<B>end</B>&nbsp;Interfaces.C.Strings;</DIV>
<DIV Class="paranum">21.a</DIV>
<DIV Class="Annotations"><B>Discussion:&nbsp;</B>The string manipulation types 
and subprograms appear in a child of Interfaces.C versus being there 
directly, since it is useful to have Interfaces.C specified as <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Pure.</DIV>
<DIV Class="paranum">21.b</DIV>
<DIV Class="Annotations">Differently named functions New_String and New_Char_Array 
are declared, since if there were a single overloaded function a call 
with a string literal as actual parameter would be ambiguous.&nbsp;</DIV>
<DIV Class="paranum">22</DIV>
<DIV Class="Normal">The type chars_ptr is C-compatible and corresponds 
to the use of C's &ldquo;char *&rdquo; for a pointer to the first char 
in a char array terminated by nul. When an object of type chars_ptr is 
declared, its value is by default set to Null_Ptr, unless the object 
is imported (see <A HREF="AA-B-1.html">B.1</A>).&nbsp;</DIV>
<DIV Class="paranum">22.a</DIV>
<DIV Class="Annotations"><B>Discussion:&nbsp;</B>The type char_array_access 
is not necessarily C-compatible, since an object of this type may carry 
&ldquo;dope&rdquo; information. The programmer should convert from char_array_access 
to chars_ptr for objects imported from, exported to, or passed to C.</DIV>
<DIV Class="paranum">23</DIV>
<DIV Class="Examples"><B>function</B>&nbsp;To_Chars_Ptr&nbsp;(Item&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array_access;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nul_Check&nbsp;:&nbsp;<B>in</B>&nbsp;Boolean&nbsp;:=&nbsp;False)<BR>
&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;chars_ptr;</DIV>
<DIV Class="paranum">24/1</DIV>
<DIV Class="CodeIndented" Style="margin-bottom: 0.9em">{<I><A HREF="defect1.html#8652/0061">8652/0061</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00140.TXT">AI95-00140-01</A></I>} 
If Item is <B>null</B>, then To_Chars_Ptr returns Null_Ptr. <SPAN class="insert1">If 
Item is not <B>null</B>,</SPAN><SPAN class="delete1">&nbsp;Otherwise, if</SPAN> 
Nul_Check is True<SPAN class="insert1">,</SPAN> and Item.<B>all</B> does 
not contain nul, then the function propagates Terminator_Error; <SPAN class="insert1">otherwise</SPAN><SPAN class="delete1">&nbsp;if 
Nul_Check is True and Item.<B>all</B> does contain nul,</SPAN> To_Chars_Ptr 
performs a pointer conversion with no allocation of memory.</DIV>
<DIV Class="paranum">25</DIV>
<DIV Class="Examples"><B>function</B>&nbsp;New_Char_Array&nbsp;(Chars&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array)&nbsp;<B>return</B>&nbsp;chars_ptr;</DIV>
<DIV Class="paranum">26</DIV>
<DIV Class="CodeIndented">This function returns a pointer to an allocated 
object initialized to Chars(Chars'First .. Index) &amp; nul, where&nbsp;</DIV>
<DIV Class="paranum">27</DIV>
<UL Class="CodeIndentedBulleted"><LI TYPE=DISC>Index = Chars'Last if 
Chars does not contain nul, or</LI></UL>
<DIV Class="paranum">28</DIV>
<UL Class="CodeIndentedBulleted"><LI TYPE=DISC>Index is the smallest 
size_t value I such that Chars(I+1) = nul.&nbsp;</LI></UL>
<DIV Class="paranum">28.1</DIV>
<DIV Class="CodeIndented" Style="margin-bottom: 0.9em"><SPAN class="delete1"></SPAN>Storage_Error 
is propagated if the allocation fails.</DIV>
<DIV Class="paranum">29</DIV>
<DIV Class="Examples"><B>function</B>&nbsp;New_String&nbsp;(Str&nbsp;:&nbsp;<B>in</B>&nbsp;String)&nbsp;<B>return</B>&nbsp;chars_ptr;</DIV>
<DIV Class="paranum">30</DIV>
<DIV Class="CodeIndented" Style="margin-bottom: 0.9em">This function 
is equivalent to New_Char_Array(To_C(Str)).</DIV>
<DIV Class="paranum">31</DIV>
<DIV Class="Examples"><B>procedure</B>&nbsp;Free&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;<B>out</B>&nbsp;chars_ptr);</DIV>
<DIV Class="paranum">32</DIV>
<DIV Class="CodeIndented" Style="margin-bottom: 0.9em">If Item is Null_Ptr, 
then Free has no effect. Otherwise, Free releases the storage occupied 
by Value(Item), and resets Item to Null_Ptr.</DIV>
<DIV Class="paranum">33</DIV>
<DIV Class="Examples"><B>function</B>&nbsp;Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;char_array;</DIV>
<DIV Class="paranum">34</DIV>
<DIV Class="CodeIndented" Style="margin-bottom: 0.9em">If Item = Null_Ptr 
then Value propagates Dereference_Error. Otherwise Value returns the 
prefix of the array of chars pointed to by Item, up to and including 
the first nul. The lower bound of the result is 0. If Item does not point 
to a nul-terminated string, then execution of Value is erroneous.</DIV>
<DIV Class="paranum">35</DIV>
<DIV Class="Examples"><B>function</B>&nbsp;Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;&nbsp;Length&nbsp;:&nbsp;<B>in</B>&nbsp;size_t)<BR>
&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;char_array;</DIV>
<DIV Class="paranum">36/1</DIV>
<DIV Class="CodeIndented" Style="margin-bottom: 0.9em">{<I><A HREF="defect1.html#8652/0062">8652/0062</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00139.TXT">AI95-00139-01</A></I>} 
If Item = Null_Ptr then Value<SPAN class="delete1">(Item)</SPAN> propagates 
Dereference_Error. Otherwise Value returns the shorter of two arrays<SPAN class="insert1">, 
either</SPAN><SPAN class="delete1">:</SPAN> the first Length chars pointed 
to by Item, <SPAN class="insert1">or</SPAN><SPAN class="delete1">&nbsp;and</SPAN> 
Value(Item). The lower bound of the result is 0. <SPAN class="insert1">If 
Length is 0, then Value propagates Constraint_Error.</SPAN>&nbsp;</DIV>
<DIV Class="paranum">36.a</DIV>
<DIV Class="Annotations"><B>Ramification:&nbsp;</B>Value(New_Char_Array(Chars)) 
= Chars if Chars does not contain nul; else Value(New_Char_Array( Chars)) 
is the prefix of Chars up to and including the first nul.&nbsp;</DIV>
<DIV Class="paranum">37</DIV>
<DIV Class="Examples"><B>function</B>&nbsp;Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;String;</DIV>
<DIV Class="paranum">38</DIV>
<DIV Class="CodeIndented" Style="margin-bottom: 0.9em">Equivalent to 
To_Ada(Value(Item), Trim_Nul=&gt;True).</DIV>
<DIV Class="paranum">39</DIV>
<DIV Class="Examples"><B>function</B>&nbsp;Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;&nbsp;Length&nbsp;:&nbsp;<B>in</B>&nbsp;size_t)<BR>
&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;String;</DIV>
<DIV Class="paranum">40/1</DIV>
<DIV Class="CodeIndented" Style="margin-bottom: 0.9em">{<I><A HREF="defect1.html#8652/0063">8652/0063</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00177.TXT">AI95-00177-01</A></I>} 
Equivalent to To_Ada(Value(Item, Length)<SPAN class="insert1">&nbsp;&amp; 
nul</SPAN>, Trim_Nul=&gt;True).</DIV>
<DIV Class="paranum">41</DIV>
<DIV Class="Examples"><B>function</B>&nbsp;Strlen&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;size_t;</DIV>
<DIV Class="paranum">42</DIV>
<DIV Class="CodeIndented" Style="margin-bottom: 0.9em">Returns <I>Val</I>'Length&ndash;1 
where <I>Val</I> = Value(Item); propagates Dereference_Error if Item 
= Null_Ptr.&nbsp;</DIV>
<DIV Class="paranum">42.a</DIV>
<DIV Class="Annotations"><B>Ramification:&nbsp;</B>Strlen returns the number 
of chars in the array pointed to by Item, up to and including the char 
immediately before the first nul.</DIV>
<DIV Class="paranum">42.b</DIV>
<DIV Class="Annotations">Strlen has the same possibility for erroneous 
execution as Value, in cases where the string has not been nul-terminated.</DIV>
<DIV Class="paranum">42.c</DIV>
<DIV Class="Annotations">Strlen has the effect of C's strlen function. 
</DIV>
<DIV Class="paranum">43</DIV>
<DIV Class="Examples"><B>procedure</B>&nbsp;Update&nbsp;(Item&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;:&nbsp;<B>in</B>&nbsp;size_t;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chars&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;&nbsp;:&nbsp;Boolean&nbsp;:=&nbsp;True);</DIV>
<DIV Class="paranum">44/1</DIV>
<DIV Class="CodeIndented" Style="margin-bottom: 0.4em">{<I><A HREF="defect1.html#8652/0064">8652/0064</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00039.TXT">AI95-00039-01</A></I>} 
<SPAN class="insert1">If Item = Null_Ptr, then Update propagates Dereference_Error. 
Otherwise, t</SPAN><SPAN class="delete1">&nbsp;T</SPAN>his procedure updates 
the value pointed to by Item, starting at position Offset, using Chars 
as the data to be copied into the array. Overwriting the nul terminator, 
and skipping with the Offset past the nul terminator, are both prevented 
if Check is True, as follows:&nbsp;</DIV>
<DIV Class="paranum">45</DIV>
<UL Class="CodeIndentedBulleted"><LI TYPE=DISC>Let N = Strlen(Item). 
If Check is True, then:&nbsp;</LI></UL>
<DIV Class="paranum">46</DIV>
<UL Class="CodeIndentedNestedBulleted"><LI TYPE=DISC>If Offset+Chars'Length&gt;N, 
propagate Update_Error.</LI></UL>
<DIV Class="paranum">47</DIV>
<UL Class="CodeIndentedNestedBulleted"><LI TYPE=DISC>Otherwise, overwrite 
the data in the array pointed to by Item, starting at the char at position 
Offset, with the data in Chars.&nbsp;</LI></UL>
<DIV Class="paranum">48</DIV>
<UL Class="CodeIndentedBulleted" Style="margin-bottom: 0.7em"><LI TYPE=DISC>If 
Check is False, then processing is as above, but with no check that Offset+Chars'Length&gt;N. 
</LI></UL>
<DIV Class="paranum">48.a</DIV>
<DIV Class="Annotations"><B>Ramification:&nbsp;</B>If Chars contains nul, 
Update's effect may be to &ldquo;shorten&rdquo; the pointed-to char array.</DIV>
<DIV Class="paranum">49</DIV>
<DIV Class="Examples"><B>procedure</B>&nbsp;Update&nbsp;(Item&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;:&nbsp;<B>in</B>&nbsp;size_t;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Str&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;String;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;Boolean&nbsp;:=&nbsp;True);</DIV>
<DIV Class="paranum">50/2</DIV>
<DIV Class="CodeIndented">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00242.TXT">AI95-00242-01</A></I>} 
Equivalent to Update(Item, Offset, To_C(Str<SPAN class="insert2">, Append_Nul 
=&gt; False</SPAN>), Check).&nbsp;</DIV>
<DIV Class="paranum">50.a/2</DIV>
<DIV Class="Annotations"><SPAN class="insert2"><B>Discussion:&nbsp;</B></SPAN>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00242.TXT">AI95-00242-01</A></I>} 
<SPAN class="insert2">To truncate the Item to the length of Str, use 
Update(Item, Offset, To_C(Str), Check) instead of Update(Item, Offset, 
Str, Check). Note that when truncating Item, Item must be longer than 
Str.</SPAN>&nbsp;</DIV>

<H4 Class="centered">Erroneous Execution</H4>
<DIV Class="paranum">51</DIV>
<DIV Class="Normal"><SPAN STYLE="font-size: 80%">{<I>erroneous execution 
(cause)</I> [partial]}</SPAN> <A NAME="I7147"></A>Execution of any of 
the following is erroneous if the Item parameter is not null_ptr and 
Item does not point to a nul-terminated array of chars.&nbsp;</DIV>
<DIV Class="paranum">52</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>a Value function not taking a Length 
parameter,</LI></UL>
<DIV Class="paranum">53</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>the Free procedure,</LI></UL>
<DIV Class="paranum">54</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>the Strlen function.&nbsp;</LI></UL>
<DIV Class="paranum">55</DIV>
<DIV Class="Normal"><SPAN STYLE="font-size: 80%">{<I>erroneous execution 
(cause)</I> [partial]}</SPAN> <A NAME="I7148"></A>Execution of Free(X) 
is also erroneous if the chars_ptr X was not returned by New_Char_Array 
or New_String.</DIV>
<DIV Class="paranum">56</DIV>
<DIV Class="Normal"><SPAN STYLE="font-size: 80%">{<I>erroneous execution 
(cause)</I> [partial]}</SPAN> <A NAME="I7149"></A>Reading or updating 
a freed char_array is erroneous.</DIV>
<DIV Class="paranum">57</DIV>
<DIV Class="Normal"><SPAN STYLE="font-size: 80%">{<I>erroneous execution 
(cause)</I> [partial]}</SPAN> <A NAME="I7150"></A>Execution of Update 
is erroneous if Check is False and a call with Check equal to True would 
have propagated Update_Error.&nbsp;</DIV>
<DIV Class="NotesHeader">NOTES</DIV>
<DIV Class="paranum">58</DIV>
<DIV Class="Notes">13&nbsp;&nbsp;New_Char_Array and New_String might 
be implemented either through the allocation function from the C environment 
(&ldquo;malloc&rdquo;) or through Ada dynamic memory allocation (&ldquo;new&rdquo;). 
The key points are&nbsp;</DIV>
<DIV Class="paranum">59</DIV>
<UL Class="NotesBulleted"><LI TYPE=DISC>the returned value (a chars_ptr) 
is represented as a C &ldquo;char *&rdquo; so that it may be passed to 
C functions;</LI></UL>
<DIV Class="paranum">60</DIV>
<UL Class="NotesBulleted"><LI TYPE=DISC>the allocated object should be 
freed by the programmer via a call of Free, not by a called C function. 
</LI></UL>

<H4 Class="centered">Inconsistencies With Ada 95</H4>
<DIV Class="paranum">60.a/2</DIV>
<DIV Class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00242.TXT">AI95-00242-01</A></I>} 
<SPAN class="insert2">{<I>inconsistencies with Ada 95</I>} <A NAME="I7151"></A><B>Amendment 
Correction:</B> Update for a String parameter is now defined to not add 
a nul character. It did add a nul in Ada 95. This means that programs 
that used this behavior of Update to truncate a string will no longer 
work (the string will not be truncated). This change makes Update for 
a string consistent with Update for a char_array (no implicit nul is 
added to the end of a char_array).</SPAN>&nbsp;</DIV>

<H4 Class="centered">Extensions to Ada 95</H4>
<DIV Class="paranum">60.b/2</DIV>
<DIV Class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00161.TXT">AI95-00161-01</A></I>} 
<SPAN class="insert2">{<I>extensions to Ada 95</I>} <A NAME="I7152"></A><B>Amendment 
Correction:</B> Added <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Preelaborable_Initialization to type chars_ptr, so that it can be used 
in preelaborated units.</SPAN></DIV>
<DIV Class="paranum">60.c/2</DIV>
<DIV Class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00276.TXT">AI95-00276-01</A></I>} 
<SPAN class="insert2"><B>Amendment Correction:</B> The components of 
chars_ptr_array are aliased so that it can be used to instantiate Interfaces.C.Pointers 
(that is its intended purpose, which is otherwise mysterious as it has 
no operations).</SPAN>&nbsp;</DIV>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<DIV Class="paranum">60.d/2</DIV>
<DIV Class="Annotations">{<I><A HREF="defect1.html#8652/0061">8652/0061</A></I>} 
<SPAN class="insert2"></SPAN>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00140.TXT">AI95-00140-01</A></I>} 
<SPAN class="insert2"><B>Corrigendum:</B> Fixed the missing semantics 
of To_Char_Ptr when Nul_Check is False.</SPAN></DIV>
<DIV Class="paranum">60.e/2</DIV>
<DIV Class="Annotations">{<I><A HREF="defect1.html#8652/0062">8652/0062</A></I>} 
<SPAN class="insert2"></SPAN>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00139.TXT">AI95-00139-01</A></I>} 
<SPAN class="insert2"><B>Corrigendum:</B> Fixed the missing semantics 
of Value when the Length is 0.</SPAN></DIV>
<DIV Class="paranum">60.f/2</DIV>
<DIV Class="Annotations">{<I><A HREF="defect1.html#8652/0063">8652/0063</A></I>} 
<SPAN class="insert2"></SPAN>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00177.TXT">AI95-00177-01</A></I>} 
<SPAN class="insert2"><B>Corrigendum:</B> Corrected the definition of 
Value to avoid raising Terminator_Error.</SPAN></DIV>
<DIV Class="paranum">60.g/2</DIV>
<DIV Class="Annotations">{<I><A HREF="defect1.html#8652/0064">8652/0064</A></I>} 
<SPAN class="insert2"></SPAN>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00039.TXT">AI95-00039-01</A></I>} 
<SPAN class="insert2"><B>Corrigendum:</B> Fixed the missing semantics 
of Update when Item is Null_Ptr.</SPAN>&nbsp;</DIV>

<HR>
<DIV Style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-B-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-B-3-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="font-size: 125%">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
