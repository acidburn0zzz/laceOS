<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Type Invariants</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert4 {text-decoration: underline; color: rgb(153,0,0) }
    SPAN.delete4 {text-decoration: line-through; color: rgb(153,0,0) }
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented3Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented3Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2NestedBulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2NestedBulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.WideHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.WideHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-4.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>7.3.2 Type Invariants</H1>
<div class="paranum"><a name="p1">1/4</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0041-1.TXT">AI12-0041-1</A></I>} 
For a private type<span class="insert4">,</span><span class="delete4">&nbsp;or</span> private extension<span class="insert4">, or interface</span>, 
the following language-defined aspects may be specified with an <SPAN Class="swiss"><A HREF="AA-13-1-1.html#S0307">aspect_specification</A></SPAN> 
(see <A HREF="AA-13-1-1.html">13.1.1</A>):</div>
<div class="paranum"><a name="p2">2/3</a></div>
<div class="WideHanging-Term">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
Type_Invariant</div><div class="WideHanging-Body"><br clear="left">
This aspect shall be specified by an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>, 
called an <I>invariant expression</I>.<A NAME="I3944"></A> Type_Invariant 
may be specified on a <SPAN Class="swiss"><A HREF="AA-7-3.html#S0193">private_type_declaration</A></SPAN>, 
on a <SPAN Class="swiss"><A HREF="AA-7-3.html#S0194">private_extension_declaration</A></SPAN>, 
or on a <SPAN Class="swiss"><A HREF="AA-3-2-1.html#S0024">full_type_declaration</A></SPAN> 
that declares the completion of a private type or private extension.<A NAME="I3945"></A><A NAME="I3946"></A></div>
<div class="paranum"><a name="p2.a">2.a/3</a></div>
<div class="Annotations"><B>Aspect Description for&nbsp;</B><B>Type_Invariant: 
</B>A condition that must hold true for all objects of a type.</div>
<div class="paranum"><a name="p3">3/4</a></div>
<div class="WideHanging-Term">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0041-1.TXT">AI12-0041-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0150-1.TXT">AI12-0150-1</A></I>} 
Type_Invariant'Class</div><div class="WideHanging-Body"><br clear="left">
This aspect shall be specified by an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>, 
called an <I>invariant expression</I>. Type_Invariant'Class may be specified 
on a <SPAN Class="swiss"><A HREF="AA-7-3.html#S0193">private_type_declaration</A></SPAN><span class="insert4">,</span><span class="delete4">&nbsp;or</span> a <SPAN Class="swiss"><A HREF="AA-7-3.html#S0194">private_extension_declaration</A></SPAN><span class="insert4">, 
or a <SPAN Class="swiss"><A HREF="AA-3-2-1.html#S0024">full_type_declaration</A></SPAN> 
for an interface type</span>.<A NAME="I3947"></A><A NAME="I3948"></A><span class="insert4">&nbsp;Type_Invariant'Class determines a <I>class-wide type invariant</I> for 
a tagged type.<A NAME="I3949"></A><A NAME="I3950"></A><A NAME="I3951"></A></span></div>
<div class="paranum"><a name="p3.a">3.a/3</a></div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0254-1.TXT">AI05-0254-1</A></I>} 
A class-wide type invariant cannot be hidden in the private part, as 
the creator of an extension needs to know about it in order to conform 
to it in any new or overriding operations. On the other hand, a specific 
type invariant is not inherited, so that no operation outside of the 
original package needs to conform to it; thus there is no need for it 
to be visible.&nbsp;</div>
<div class="paranum"><a name="p3.b">3.b/3</a></div>
<div class="Annotations"><B>Aspect Description for&nbsp;</B><B>Type_Invariant'Class: 
</B>A condition that must hold true for all objects in a class of types.</div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p4">4/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
The expected type for an invariant expression is any boolean type.<A NAME="I3952"></A></div>
<div class="paranum"><a name="p5">5/4</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0150-1.TXT">AI12-0150-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0159-1.TXT">AI12-0159-1</A></I>} 
[Within an invariant expression, the identifier of the first subtype 
of the associated type denotes the current instance of the type.] Within 
an invariant expression <span class="insert4">for the Type_Invariant 
aspect of a</span><span class="delete4">&nbsp;associated with</span> type 
<I>T</I>, the type of <span class="insert4">this</span><span class="delete4">&nbsp;the</span> 
current instance is <I>T</I><span class="insert4">. Within an invariant 
expression</span><span class="delete4">&nbsp;for the Type_Invariant aspect 
and <I>T</I>'Class</span> for the Type_Invariant'Class aspect<span class="insert4">&nbsp;of a type <I>T</I>, the type of this current instance is interpreted 
as though it had a (notional) type <I>NT</I> that is a visible formal 
derived type whose ancestor type is <I>T</I>.[ The effect of this interpretation 
is that the only operations that can be applied to this current instance 
are those defined for such a formal derived type.]</span><span class="delete4">.</span></div>
<div class="paranum"><a name="p5.a">5.a/3</a></div>
<div class="Annotations"><B>Proof:&nbsp;</B>The first sentence is given formally 
in <A HREF="AA-13-1-1.html">13.1.1</A>.&nbsp;</div>
<div class="paranum"><a name="p5.b">5.b/4</a></div>
<div class="Annotations"><span class="insert4"><B>Reason:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0159-1.TXT">AI12-0159-1</A></I>} 
<span class="insert4">The rules for Type_Invariant'Class ensure that 
the invariant expression is well-defined for any type descended from 
<I>T</I>.</span>&nbsp;</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p6">6/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
[The Type_Invariant'Class aspect shall not be specified for an untagged 
type.] The Type_Invariant aspect shall not be specified for an abstract 
type.</div>
<div class="paranum"><a name="p6.a">6.a/3</a></div>
<div class="Annotations"><B>Proof:&nbsp;</B>The first sentence is given formally 
in <A HREF="AA-13-1-1.html">13.1.1</A>.&nbsp;</div>
<div class="paranum"><a name="p6.1">6.1/4</a></div>
<div class="Normal">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI12-0042-1</A></I>} 
<span class="insert4">If a type extension occurs at a point where a private 
operation of some ancestor is visible and inherited, and a Type_Invariant'Class 
expression applies to that ancestor, then the inherited operation shall 
be abstract or shall be overridden.</span>&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p7">7/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
[If the Type_Invariant aspect is specified for a type <I>T</I>, then 
the invariant expression applies to <I>T</I>.]</div>
<div class="paranum"><a name="p8">8/3</a></div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
[If the Type_Invariant'Class aspect is specified for a tagged type <I>T</I>, 
then the invariant expression applies to all descendants of <I>T</I>.]</div>
<div class="paranum"><a name="p8.a">8.a/3</a></div>
<div class="Annotations"><B>Proof:&nbsp;</B>&quot;Applies&quot; is formally 
defined in <A HREF="AA-13-1-1.html">13.1.1</A>.&nbsp;</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p9">9/4</a></div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0247-1.TXT">AI05-0247-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0290-1.TXT">AI05-0290-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0150-1.TXT">AI12-0150-1</A></I>} 
If one or more invariant expressions apply to a <span class="insert4">nonabstract 
</span>type <I>T</I>, then an invariant check is performed at the following 
places, on the specified object(s):<A NAME="I3953"></A><A NAME="I3954"></A></div>
<div class="paranum"><a name="p10">10/4</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0133-1.TXT">AI12-0133-1</A></I>} 
After successful <span class="delete4">default&nbsp;</span>initialization 
of an object of type <I>T</I><span class="insert4">&nbsp;by default (see <A HREF="AA-3-3-1.html">3.3.1</A>)</span>, 
the check is performed on the new object<span class="insert4">&nbsp;unless 
the partial view of <I>T</I> has unknown discriminants</span>;</div>
<div class="paranum"><a name="p10.a">10.a/4</a></div>
<div class="Annotations"><span class="insert4"><B>Reason:&nbsp;</B></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0133-1.TXT">AI12-0133-1</A></I>} 
<span class="insert4">The check applies everywhere, even in the package 
body, because default initialization has to work the same for clients 
as it does within the package. As such, checks within the package are 
either harmless or will uncover a bug that could also happen to a client. 
However, if the partial view of the type has unknown discriminants, no 
client of the package can declare a default-initialized object. Therefore, 
no invariant check is needed, as all default initialized objects are 
necessarily inside the package.</span>&nbsp;</div>
<div class="paranum"><a name="p10.1">10.1/4</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0049-1.TXT">AI12-0049-1</A></I>} 
<span class="insert4">After successful explicit initialization of the 
completion of a deferred constant with a part of type <I>T</I>, if the 
completion is inside the immediate scope of the full view of <I>T</I>, 
and the deferred constant is visible outside the immediate scope of <I>T</I>, 
the check is performed on the part(s) of type <I>T</I>;</span></div>
<div class="paranum"><a name="p11">11/3</a></div>
<div class="Bulleted">After successful conversion to type <I>T</I>, the 
check is performed on the result of the conversion;</div>
<div class="paranum"><a name="p12">12/3</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
For a view conversion, outside the immediate scope of <I>T</I>, that 
converts from a descendant of <I>T</I> (including <I>T</I> itself) to 
an ancestor of type <I>T</I> (other than <I>T</I> itself), a check is 
performed on the part of the object that is of type <I>T</I>:</div>
<div class="paranum"><a name="p13">13/3</a></div>
<div class="Indented2NestedBulleted">after assigning to the view conversion; 
and</div>
<div class="paranum"><a name="p14">14/3</a></div>
<div class="Indented2NestedBulleted">after successful return from a call 
that passes the view conversion as an <B>in out</B> or <B>out</B> parameter. 
</div>
<div class="paranum"><a name="p14.a">14.a/3</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>For a single view conversion 
that converts between distantly related types, this rule could be triggered 
for multiple types and thus multiple invariant checks may be needed. 
</div>
<div class="paranum"><a name="p14.b">14.b/3</a></div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0299-1.TXT">AI05-0299-1</A></I>} 
For calls to inherited subprograms (including dispatching calls), the 
implied view conversions mean that a wrapper is probably needed. (See 
the Note at the bottom of this subclause for more on the model of checks 
for inherited subprograms.)</div>
<div class="paranum"><a name="p14.c">14.c/3</a></div>
<div class="Annotations">For view conversions involving class-wide types, 
the exact checks needed may not be known at compile-time. One way to 
deal with this is to have an implicit dispatching operation that is given 
the object to check and the tag of the target of the conversion, and 
which first checks if the passed tag is not for itself, and if not, checks 
the its invariant on the object and then calls the operation of its parent 
type. If the tag is for itself, the operation is complete.&nbsp;</div>
<div class="paranum"><a name="p15">15/4</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0146-1.TXT">AI12-0146-1</A></I>} 
After a successful call on the Read or Input <span class="insert4">stream-oriented</span><span class="delete4">&nbsp;stream</span> 
attribute of the type <I>T</I>, the check is performed on the object 
initialized by the <span class="delete4">stream&nbsp;</span>attribute;</div>
<div class="paranum"><a name="p16">16/3</a></div>
<div class="Bulleted" style="margin-bottom: 0.3em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
An invariant is checked upon successful return from a call on any subprogram 
or entry that:&nbsp;</div>
<div class="paranum"><a name="p17">17/4</a></div>
<div class="Indented2Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI12-0042-1</A></I>} 
is declared within the immediate scope of type <I>T</I> (or by an instance 
of a generic unit, and the generic is declared within the immediate scope 
of type <I>T</I>),<span class="delete4">&nbsp;and</span></div>
<div class="paranum"><a name="p18">18/4</a></div>
<div class="Indented2Bulleted"><SPAN STYLE="font-size: 80%"><I>This paragraph 
was deleted.</I></SPAN>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI12-0042-1</A></I>} 
<span class="delete4">is visible outside the immediate scope of type 
<I>T</I> or overrides an operation that is visible outside the immediate 
scope of <I>T</I>, and</span></div>
<div class="paranum"><a name="p19">19/4</a></div>
<div class="Indented2Bulleted" style="margin-bottom: 0.3em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0289-1.TXT">AI05-0289-1</A></I>} 
<span class="insert4"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI12-0042-1</A></I>} 
<span class="insert4"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0044-1.TXT">AI12-0044-1</A></I>} 
<span class="insert4"></span><span class="insert4">and either:</span><span class="delete4">&nbsp;has 
a result with a part of type <I>T</I>, or one or more parameters with 
a part of type <I>T</I>, or an access to variable parameter whose designated 
type has a part of type <I>T</I>.</span></div>
<div class="paranum"><a name="p19.1">19.1/4</a></div>
<div class="Indented3Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0044-1.TXT">AI12-0044-1</A></I>} 
<span class="insert4">has a result with a part of type <I>T</I>, or</span></div>
<div class="paranum"><a name="p19.2">19.2/4</a></div>
<div class="Indented3Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0044-1.TXT">AI12-0044-1</A></I>} 
<span class="insert4">has one or more <B>out</B> or <B>in out</B> parameters 
with a part of type <I>T</I>, or</span></div>
<div class="paranum"><a name="p19.3">19.3/4</a></div>
<div class="Indented3Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0044-1.TXT">AI12-0044-1</A></I>} 
<span class="insert4"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0149-1.TXT">AI12-0149-1</A></I>} 
<span class="insert4">has an access-to-object parameter or result whose 
designated type has a part of type <I>T</I>, or</span></div>
<div class="paranum"><a name="p19.4">19.4/4</a></div>
<div class="Indented3Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI12-0042-1</A></I>} 
<span class="insert4"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0044-1.TXT">AI12-0044-1</A></I>} 
<span class="insert4">is a procedure or entry that has an <B>in</B> parameter 
with a part of type <I>T</I>,</span></div>
<div class="paranum"><a name="p19.a">19.a/4</a></div>
<div class="Annotations"><span class="insert4"><B>Discussion:&nbsp;</B>We 
don't check <B>in</B> parameters for functions to avoid infinite recursion 
for calls to public functions appearing in invariant expressions. Such 
function calls are unavoidable for class-wide invariants and likely for 
other invariants. This is the simplest rule that avoids trouble, and 
functions are much more likely to be queries that don't modify their 
parameters than other callable entities.</span>&nbsp;</div>
<div class="paranum"><a name="p19.5">19.5/4</a></div>
<div class="Indented2Bulleted" style="margin-bottom: 0.3em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI12-0042-1</A></I>} 
<span class="insert4">and either:</span></div>
<div class="paranum"><a name="p19.6">19.6/4</a></div>
<div class="Indented3Bulleted"><span class="insert4"><I>T</I> is a private 
type or a private extension and the subprogram or entry is visible outside 
the immediate scope of type <I>T</I> or overrides an inherited operation 
that is visible outside the immediate scope of <I>T</I>, or</span></div>
<div class="paranum"><a name="p19.7">19.7/4</a></div>
<div class="Indented3Bulleted"><span class="insert4"><I>T</I> is a record 
extension, and the subprogram or entry is a primitive operation visible 
outside the immediate scope of type <I>T</I> or overrides an inherited 
operation that is visible outside the immediate scope of <I>T</I>.</span> 
</div>
<div class="paranum"><a name="p20">20/3</a></div>
<div class="Bulleted-NoPrefix">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
The check is performed on each such part of type <I>T</I>.</div>
<div class="paranum"><a name="p20.1">20.1/4</a></div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI12-0042-1</A></I>} 
<span class="insert4">For a view conversion to a class-wide type occurring 
within the immediate scope of <I>T</I>, from a specific type that is 
a descendant of <I>T</I> (including <I>T</I> itself), a check is performed 
on the part of the object that is of type <I>T</I>.</span></div>
<div class="paranum"><a name="p20.a">20.a/4</a></div>
<div class="Annotations"><span class="insert4"><B>Reason:&nbsp;</B>Class-wide 
objects are treated as though they exist outside the scope of every type, 
and may be passed across package &quot;boundaries&quot; freely without 
further invariant checks.</span>&nbsp;</div>
<div class="paranum"><a name="p21">21/4</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0290-1.TXT">AI05-0290-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0080-1.TXT">AI12-0080-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0159-1.TXT">AI12-0159-1</A></I>} 
If performing checks is required by the <span class="insert4">Type_Invariant</span><span class="delete4">&nbsp;Invariant</span> 
or <span class="insert4">Type_Invariant'Class</span><span class="delete4">&nbsp;Invariant'Class</span> 
assertion policies (see <A HREF="AA-11-4-2.html">11.4.2</A>) in effect 
at the point of <span class="insert4">the&nbsp;</span>corresponding aspect 
specification applicable to a given type, then the respective invariant 
expression is considered <I>enabled</I>.<A NAME="I3955"></A></div>
<div class="paranum"><a name="p21.a">21.a/3</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>If a class-wide invariant 
expression is enabled for a type, it remains enabled when inherited by 
descendants of that type, even if the policy in effect is Ignore for 
the inheriting type.&nbsp;</div>
<div class="paranum"><a name="p22">22/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0289-1.TXT">AI05-0289-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0290-1.TXT">AI05-0290-1</A></I>} 
The invariant check consists of the evaluation of each enabled invariant 
expression that applies to <I>T</I>, on each of the objects specified 
above. If any of these evaluate to False, Assertions.Assertion_Error 
is raised at the point of the object initialization, conversion, or call.<A NAME="I3956"></A> 
If a given call requires more than one evaluation of an invariant expression, 
either for multiple objects of a single type or for multiple types with 
invariants, the evaluations are performed in an arbitrary order, and 
if one of them evaluates to False, it is not specified whether the others 
are evaluated. Any invariant check is performed prior to copying back 
any by-copy <B>in out</B> or <B>out</B> parameters. Invariant checks, 
any postcondition check, and any constraint or predicate checks associated 
with <B>in out</B> or <B>out</B> parameters are performed in an arbitrary 
order.</div>
<div class="paranum"><a name="p22.1">22.1/4</a></div>
<div class="Normal">&nbsp;&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0150-1.TXT">AI12-0150-1</A></I>} 
<span class="insert4"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0159-1.TXT">AI12-0159-1</A></I>} 
<span class="insert4">For an invariant check on a value of type <I>T1</I> 
based on a class-wide invariant expression inherited from an ancestor 
type <I>T</I>, any operations within the invariant expression that were 
resolved as primitive operations of the (notional) formal derived type 
<I>NT</I> are bound to the corresponding operations of type <I>T1</I> 
in the evaluation of the invariant expression for the check on <I>T1</I>.</span></div>
<div class="paranum"><a name="p23">23/3</a></div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0247-1.TXT">AI05-0247-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
The invariant checks performed on a call are determined by the subprogram 
or entry actually invoked, whether directly, as part of a dispatching 
call, or as part of a call through an access-to-subprogram value.</div>
<div class="paranum"><a name="p23.a">23.a/4</a></div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0149-1.TXT">AI12-0149-1</A></I>} 
Invariant checks on subprogram return are not performed on objects that 
are accessible only through access values<span class="insert4">&nbsp;that 
are subcomponents of some other object</span>. It is also possible to 
call through an access-to-subprogram value and reach a subprogram body 
that has visibility on the full declaration of a type, from outside the 
immediate scope of the type. No invariant checks will be performed if 
the designated subprogram is not itself externally visible. These cases 
represent &quot;holes&quot; in the protection provided by invariant checks; 
but note that these holes cannot be caused by clients of the type <I>T</I> 
with the invariant<span class="insert4">. The designer of the package 
has to declare a visible type with an access-to-<I>T</I> subcomponent 
and use it as a parameter or result to subprograms in the package, or 
pass the client an access-to-subprogram value representing a private 
operation of the package. In the absence of such things, all values that 
the client can see will be checked for a private type or extension</span><span class="delete4">&nbsp;without help for the designer of the package containing <I>T</I></span>. 
</div>
<div class="paranum"><a name="p23.b">23.b/3</a></div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>The implementation 
might want to produce a warning if a private extension has an ancestor 
type that is a visible extension, and an invariant expression depends 
on the value of one of the components from a visible extension part. 
</div>
<div class="NotesHeader">NOTES</div>
<div class="paranum"><a name="p24">24/3</a></div>
<div class="Notes">13&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
For a call of a primitive subprogram of type <I>NT</I> that is inherited 
from type <I>T</I>, the specified checks of the specific invariants of 
both the types <I>NT</I> and <I>T</I> are performed. For a call of a 
primitive subprogram of type <I>NT</I> that is overridden for type <I>NT</I>, 
the specified checks of the specific invariants of only type <I>NT</I> 
are performed.</div>
<div class="paranum"><a name="p24.a">24.a/3</a></div>
<div class="Annotations"><B>Proof:&nbsp;</B>This follows from the definition 
of a call on an inherited subprogram as view conversions of the parameters 
of the type and a call to the original subprogram (see <A HREF="AA-3-4.html">3.4</A>), 
along with the normal invariant checking rules. In particular, the call 
to the original subprogram takes care of any checks needed on type <I>T</I>, 
and the checks required on view conversions take care of any checks needed 
on type <I>NT</I>, specifically on <B>in out</B> and <B>out</B> parameters. 
We require this in order that the semantics of an explicitly defined 
wrapper that does nothing but call the original subprogram is the same 
as that of an inherited subprogram.&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum"><a name="p24.b">24.b/3</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0247-1.TXT">AI05-0247-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0289-1.TXT">AI05-0289-1</A></I>} 
<A NAME="I3957"></A>Type_Invariant aspects are new.&nbsp;</div>

<H4 Class="centered">Inconsistencies With Ada 2012</H4>
<div class="paranum"><a name="p24.c">24.c/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI12-0042-1</A></I>} 
<span class="insert4"><A NAME="I3958"></A><B>Corrigendum:</B> Clarified 
the definition of when invariant checks occur for inherited subprograms. 
This might cause checks to be added or removed in some cases. These are 
all rare cases involving class-wide type invariants and either record 
extensions or multiple levels of derivation. Additionally, implementations 
probably make the checks as the intent seems clear, even though the formal 
language did not include them. So we do not expect this to be a problem 
in practice.</span></div>
<div class="paranum"><a name="p24.d">24.d/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI12-0042-1</A></I>} 
<span class="insert4"><B>Corrigendum:</B> Added invariant checks for 
conversions to class-wide types. This might cause an invariant check 
to fail in some cases where they would not be made in the original definition 
of Ada 2012. Such cases represent a hole where a value that fails an 
invariant could &quot;leak out&quot; of a package, and as such will detect 
far more bugs than it causes.</span></div>
<div class="paranum"><a name="p24.e">24.e/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0044-1.TXT">AI12-0044-1</A></I>} 
<span class="insert4"><B>Corrigendum:</B> Removed the invariant check 
for <B>in</B> parameters of functions, so that typical invariants don't 
cause infinite recursion. This is strictly inconsistent, as the Ada 2012 
definition has this check; therefore, programs could depend on Assertion_Error 
being raised upon the return from some call on a public function. However, 
as the intent of assertion checking is to uncover bugs, a program that 
depends on a bug occurring seems very unlikely.</span></div>
<div class="paranum"><a name="p24.f">24.f/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0049-1.TXT">AI12-0049-1</A></I>} 
<span class="insert4"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0149-1.TXT">AI12-0149-1</A></I>} 
<span class="insert4"><B>Corrigendum:</B> Added an invariant check for 
deferred constants and for access values returned from functions, so 
they cannot be used to &ldquo;leak&rdquo; values that violate the invariant 
from a package. This is strictly inconsistent, as the Ada 2012 definition 
is missing these checks; therefore, programs could depend on using values 
that violate an invariant outside of the package of definition. These 
will not raise Assertion_Error in Ada 2012 as defined in the Ada 2012 
Standard, but ought to do so (as noted by this change). As these are 
a violation of the intent of invariants, we think that this change will 
mainly reveal bugs rather than cause them.</span></div>
<div class="paranum"><a name="p24.g">24.g/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0150-1.TXT">AI12-0150-1</A></I>} 
<span class="insert4"></span>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0159-1.TXT">AI12-0159-1</A></I>} 
<span class="insert4"><B>Corrigendum:</B> Eliminated unintentional redispatching 
from class-wide type invariants. This means that a different body might 
be evaluated for a type invariant check where the value has a different 
tag than that of the type. The change means that the behavior of Type_Invariant 
and Type_Invariant'Class will be the same for a particular subprogram, 
and that the known behavior of the operations can be assumed. We expect 
that this change will primarily fix bugs, as it will make class-wide 
type invariants work more like expected. In the case where redispatching 
is desired, an explicit conversion to a class-wide type can be used.</span> 
</div>

<H4 Class="centered">Incompatibilities With Ada 2012</H4>
<div class="paranum"><a name="p24.h">24.h/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0042-1.TXT">AI12-0042-1</A></I>} 
<span class="insert4"><A NAME="I3959"></A><B>Corrigendum:</B> A private 
operation that is inherited in the visible part of a package to which 
a class-wide invariant applies now requires overriding. This is a very 
unlikely situation, and will prevent problems with invariant checks being 
added to routines that assume that they don't need them.</span>&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2012</H4>
<div class="paranum"><a name="p24.i">24.i/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0041-1.TXT">AI12-0041-1</A></I>} 
<span class="insert4"><A NAME="I3960"></A><B>Corrigendum:</B> Class-wide 
type invariants can now be specified on interfaces as well as private 
types.</span>&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 2012</H4>
<div class="paranum"><a name="p24.j">24.j/4</a></div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI12s/AI12-0133-1.TXT">AI12-0133-1</A></I>} 
<span class="insert4"><B>Corrigendum:</B> Clarified that all objects 
that are initialized by default should have an invariant check, and added 
an exception for types with unknown discriminants, as in that case the 
client cannot declare a default-initialized object. This exception to 
the check is formally inconsistent, but since it is only removing an 
assertion failure that occurs where no assertion should be checked anyway 
(meaning it's more likely to fix a bug than cause one), and programs 
depending on assertion failure should be very rare outside of test cases, 
we don't document this as inconsistent.</span>&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-4.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
