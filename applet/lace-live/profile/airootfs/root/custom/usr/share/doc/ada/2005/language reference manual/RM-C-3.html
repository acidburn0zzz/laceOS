<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Interrupt Support</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Enumerated-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Enumerated-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,0,153)"><B>Ada Reference Manual</B></SPAN> &mdash; <A HREF="RM-TTL.html"><B>Legal Information</B></A></DIV>
<DIV Style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-2.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-3-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<HR>
<H1>C.3 Interrupt Support</H1>
<DIV Class="paranum">1</DIV>
<DIV Class="Normal">This clause specifies the language-defined model 
for hardware interrupts in addition to mechanisms for handling interrupts. 
<A NAME="I6665"></A></DIV>

<H4 Class="centered">Dynamic Semantics</H4>
<DIV Class="paranum">2</DIV>
<DIV Class="Normal"><A NAME="I6666"></A>An <I>interrupt</I> represents 
a class of events that are detected by the hardware or the system software. 
<A NAME="I6667"></A>Interrupts are said to occur. An <I>occurrence</I> 
of an interrupt is separable into generation and delivery. <A NAME="I6668"></A><I>Generation</I> 
of an interrupt is the event in the underlying hardware or system that 
makes the interrupt available to the program. <A NAME="I6669"></A><I>Delivery</I> 
is the action that invokes part of the program as response to the interrupt 
occurrence. <A NAME="I6670"></A>Between generation and delivery, the 
interrupt occurrence (or interrupt) is <I>pending</I>. <A NAME="I6671"></A>Some 
or all interrupts may be <I>blocked</I>. When an interrupt is blocked, 
all occurrences of that interrupt are prevented from being delivered. 
<A NAME="I6672"></A><A NAME="I6673"></A>Certain interrupts are <I>reserved</I>. 
The set of reserved interrupts is implementation defined. A reserved 
interrupt is either an interrupt for which user-defined handlers are 
not supported, or one which already has an attached handler by some other 
implementation-defined means. <A NAME="I6674"></A><A NAME="I6675"></A>Program 
units can be connected to non-reserved interrupts. While connected, the 
program unit is said to be <I>attached</I> to that interrupt. The execution 
of that program unit, the <I>interrupt handler</I>, is invoked upon delivery 
of the interrupt occurrence.&nbsp;</DIV>
<DIV Class="paranum">3</DIV>
<DIV Class="Normal">While a handler is attached to an interrupt, it is 
called once for each delivered occurrence of that interrupt. While the 
handler executes, the corresponding interrupt is blocked.</DIV>
<DIV Class="paranum">4</DIV>
<DIV Class="Normal">While an interrupt is blocked, all occurrences of 
that interrupt are prevented from being delivered. Whether such occurrences 
remain pending or are lost is implementation defined.</DIV>
<DIV Class="paranum">5</DIV>
<DIV Class="Normal"><A NAME="I6676"></A>Each interrupt has a <I>default 
treatment</I> which determines the system's response to an occurrence 
of that interrupt when no user-defined handler is attached. The set of 
possible default treatments is implementation defined, as is the method 
(if one exists) for configuring the default treatments for interrupts.</DIV>
<DIV Class="paranum">6</DIV>
<DIV Class="Normal">An interrupt is delivered to the handler (or default 
treatment) that is in effect for that interrupt at the time of delivery.</DIV>
<DIV Class="paranum">7</DIV>
<DIV Class="Normal">An exception propagated from a handler that is invoked 
by an interrupt has no effect.</DIV>
<DIV Class="paranum">8</DIV>
<DIV Class="Normal">If the Ceiling_Locking policy (see <A HREF="RM-D-3.html">D.3</A>) 
is in effect, the interrupt handler executes with the active priority 
that is the ceiling priority of the corresponding protected object.</DIV>

<H4 Class="centered">Implementation Requirements</H4>
<DIV Class="paranum">9</DIV>
<DIV Class="Normal">The implementation shall provide a mechanism to determine 
the minimum stack space that is needed for each interrupt handler and 
to reserve that space for the execution of the handler. This space should 
accommodate nested invocations of the handler where the system permits 
this.</DIV>
<DIV Class="paranum">10</DIV>
<DIV Class="Normal">If the hardware or the underlying system holds pending 
interrupt occurrences, the implementation shall provide for later delivery 
of these occurrences to the program.</DIV>
<DIV Class="paranum">11</DIV>
<DIV Class="Normal">If the Ceiling_Locking policy is not in effect, the 
implementation shall provide means for the application to specify whether 
interrupts are to be blocked during protected actions.</DIV>

<H4 Class="centered">Documentation Requirements</H4>
<DIV Class="paranum">12</DIV>
<DIV Class="Normal" Style="margin-bottom: 0.4em">The implementation 
shall document the following items:&nbsp;</DIV>
<DIV Class="paranum">13</DIV>
<DIV Class="Enumerated-Term">1.</DIV><DIV Class="Enumerated-Body">
For each interrupt, which interrupts are blocked from delivery when a 
handler attached to that interrupt executes (either as a result of an 
interrupt delivery or of an ordinary call on a procedure of the corresponding 
protected object).</DIV>
<DIV Class="paranum">14</DIV>
<DIV Class="Enumerated-Term">2.</DIV><DIV Class="Enumerated-Body">
Any interrupts that cannot be blocked, and the effect of attaching handlers 
to such interrupts, if this is permitted.</DIV>
<DIV Class="paranum">15</DIV>
<DIV Class="Enumerated-Term">3.</DIV><DIV Class="Enumerated-Body">
Which run-time stack an interrupt handler uses when it executes as a 
result of an interrupt delivery; if this is configurable, what is the 
mechanism to do so; how to specify how much space to reserve on that 
stack.</DIV>
<DIV Class="paranum">16</DIV>
<DIV Class="Enumerated-Term">4.</DIV><DIV Class="Enumerated-Body">
Any implementation- or hardware-specific activity that happens before 
a user-defined interrupt handler gets control (e.g., reading device registers, 
acknowledging devices).</DIV>
<DIV Class="paranum">17</DIV>
<DIV Class="Enumerated-Term">5.</DIV><DIV Class="Enumerated-Body">
Any timing or other limitations imposed on the execution of interrupt 
handlers.</DIV>
<DIV Class="paranum">18</DIV>
<DIV Class="Enumerated-Term">6.</DIV><DIV Class="Enumerated-Body">
The state (blocked/unblocked) of the non-reserved interrupts when the 
program starts; if some interrupts are unblocked, what is the mechanism 
a program can use to protect itself before it can attach the corresponding 
handlers.</DIV>
<DIV Class="paranum">19</DIV>
<DIV Class="Enumerated-Term">7.</DIV><DIV Class="Enumerated-Body">
Whether the interrupted task is allowed to resume execution before the 
interrupt handler returns.</DIV>
<DIV Class="paranum">20</DIV>
<DIV Class="Enumerated-Term">8.</DIV><DIV Class="Enumerated-Body">
The treatment of interrupt occurrences that are generated while the interrupt 
is blocked; i.e., whether one or more occurrences are held for later 
delivery, or all are lost.</DIV>
<DIV Class="paranum">21</DIV>
<DIV Class="Enumerated-Term">9.</DIV><DIV Class="Enumerated-Body">
Whether predefined or implementation-defined exceptions are raised as 
a result of the occurrence of any interrupt, and the mapping between 
the machine interrupts (or traps) and the predefined exceptions.</DIV>
<DIV Class="paranum">22</DIV>
<DIV Class="Enumerated-Term">10.</DIV><DIV Class="Enumerated-Body">
On a multi-processor, the rules governing the delivery of an interrupt 
to a particular processor.&nbsp;</DIV>

<H4 Class="centered">Implementation Permissions</H4>
<DIV Class="paranum">23/2</DIV>
<DIV Class="Normal">&nbsp;If the underlying system or hardware does not allow 
interrupts to be blocked, then no blocking is required as part of the 
execution of subprograms of a protected object for which one of its subprograms 
is an interrupt handler.</DIV>
<DIV Class="paranum">24</DIV>
<DIV Class="Normal">In a multi-processor with more than one interrupt 
subsystem, it is implementation defined whether (and how) interrupt sources 
from separate subsystems share the same Interrupt_ID type (see <A HREF="RM-C-3-2.html">C.3.2</A>). 
In particular, the meaning of a blocked or pending interrupt may then 
be applicable to one processor only.&nbsp;</DIV>
<DIV Class="paranum">25</DIV>
<DIV Class="Normal">Implementations are allowed to impose timing or other 
limitations on the execution of interrupt handlers.&nbsp;</DIV>
<DIV Class="paranum">26/2</DIV>
<DIV Class="Normal">&nbsp;Other forms of handlers are allowed to be supported, 
in which case the rules of this clause should be adhered to.</DIV>
<DIV Class="paranum">27</DIV>
<DIV Class="Normal">The active priority of the execution of an interrupt 
handler is allowed to vary from one occurrence of the same interrupt 
to another.</DIV>

<H4 Class="centered">Implementation Advice</H4>
<DIV Class="paranum">28/2</DIV>
<DIV Class="Normal">&nbsp;If the Ceiling_Locking policy is not in effect, 
the implementation should provide means for the application to specify 
which interrupts are to be blocked during protected actions, if the underlying 
system allows for finer-grained control of interrupt blocking.&nbsp;</DIV>
<DIV Class="NotesHeader">NOTES</DIV>
<DIV Class="paranum">29</DIV>
<DIV Class="Notes">1&nbsp;&nbsp;The default treatment for an interrupt 
can be to keep the interrupt pending or to deliver it to an implementation-defined 
handler. Examples of actions that an implementation-defined handler is 
allowed to perform include aborting the partition, ignoring (i.e., discarding 
occurrences of) the interrupt, or queuing one or more occurrences of 
the interrupt for possible later delivery when a user-defined handler 
is attached to that interrupt.</DIV>
<DIV Class="paranum">30</DIV>
<DIV Class="Notes">2&nbsp;&nbsp;It is a bounded error to call Task_Identification.Current_Task 
(see <A HREF="RM-C-7-1.html">C.7.1</A>) from an interrupt handler.</DIV>
<DIV Class="paranum">31</DIV>
<DIV Class="Notes">3&nbsp;&nbsp;The rule that an exception propagated 
from an interrupt handler has no effect is modeled after the rule about 
exceptions propagated out of task bodies.</DIV>

<HR>
<DIV Style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-2.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-3-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
