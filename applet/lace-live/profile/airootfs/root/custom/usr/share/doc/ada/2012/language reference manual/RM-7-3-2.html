<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Type Invariants</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    A.Bar:link {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    A.Bar:visited {font-family: Arial, Helvetica, sans-serif; font-style: normal; text-decoration: none; color: rgb(204,204,51)}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented3Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented3Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2NestedBulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2NestedBulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.WideHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.WideHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,0,153)"><B>Ada Reference Manual</B></SPAN> &mdash; <A HREF="RM-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-7-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-7-4.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>7.3.2 Type Invariants</H1>
<div class="paranum"><a name="p1">1/4</a></div>
<div class="Normal" style="margin-bottom: 0.4em">For a private type, 
private extension, or interface, the following language-defined aspects 
may be specified with an <SPAN Class="swiss"><A HREF="RM-13-1-1.html#S0307">aspect_specification</A></SPAN> 
(see <A HREF="RM-13-1-1.html">13.1.1</A>):</div>
<div class="paranum"><a name="p2">2/3</a></div>
<div class="WideHanging-Term">Type_Invariant</div><div class="WideHanging-Body"><br clear="left">
This aspect shall be specified by an <SPAN Class="swiss"><A HREF="RM-4-4.html#S0117">expression</A></SPAN>, 
called an <I>invariant expression</I>.<A NAME="I3627"></A> Type_Invariant 
may be specified on a <SPAN Class="swiss"><A HREF="RM-7-3.html#S0193">private_type_declaration</A></SPAN>, 
on a <SPAN Class="swiss"><A HREF="RM-7-3.html#S0194">private_extension_declaration</A></SPAN>, 
or on a <SPAN Class="swiss"><A HREF="RM-3-2-1.html#S0024">full_type_declaration</A></SPAN> 
that declares the completion of a private type or private extension.<A NAME="I3628"></A><A NAME="I3629"></A></div>
<div class="paranum"><a name="p3">3/4</a></div>
<div class="WideHanging-Term">Type_Invariant'Class</div><div class="WideHanging-Body"><br clear="left">
This aspect shall be specified by an <SPAN Class="swiss"><A HREF="RM-4-4.html#S0117">expression</A></SPAN>, 
called an <I>invariant expression</I>. Type_Invariant'Class may be specified 
on a <SPAN Class="swiss"><A HREF="RM-7-3.html#S0193">private_type_declaration</A></SPAN>, 
a <SPAN Class="swiss"><A HREF="RM-7-3.html#S0194">private_extension_declaration</A></SPAN>, 
or a <SPAN Class="swiss"><A HREF="RM-3-2-1.html#S0024">full_type_declaration</A></SPAN> 
for an interface type.<A NAME="I3630"></A><A NAME="I3631"></A> Type_Invariant'Class 
determines a <I>class-wide type invariant</I> for a tagged type.<A NAME="I3632"></A><A NAME="I3633"></A><A NAME="I3634"></A></div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum"><a name="p4">4/3</a></div>
<div class="Normal">The expected type for an invariant expression is 
any boolean type.<A NAME="I3635"></A></div>
<div class="paranum"><a name="p5">5/4</a></div>
<div class="Normal">Within an invariant expression, the identifier of 
the first subtype of the associated type denotes the current instance 
of the type. Within an invariant expression for the Type_Invariant aspect 
of a type <I>T</I>, the type of this current instance is <I>T</I>. Within 
an invariant expression for the Type_Invariant'Class aspect of a type 
<I>T</I>, the type of this current instance is interpreted as though 
it had a (notional) type <I>NT</I> that is a visible formal derived type 
whose ancestor type is <I>T</I>. The effect of this interpretation is 
that the only operations that can be applied to this current instance 
are those defined for such a formal derived type.</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum"><a name="p6">6/3</a></div>
<div class="Normal">The Type_Invariant'Class aspect shall not be specified 
for an untagged type. The Type_Invariant aspect shall not be specified 
for an abstract type.</div>
<div class="paranum"><a name="p6.1">6.1/4</a></div>
<div class="Normal">&nbsp;&nbsp;If a type extension occurs at a point where a private 
operation of some ancestor is visible and inherited, and a Type_Invariant'Class 
expression applies to that ancestor, then the inherited operation shall 
be abstract or shall be overridden.&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum"><a name="p7">7/3</a></div>
<div class="Normal">If the Type_Invariant aspect is specified for a type 
<I>T</I>, then the invariant expression applies to <I>T</I>.</div>
<div class="paranum"><a name="p8">8/3</a></div>
<div class="Normal">If the Type_Invariant'Class aspect is specified for 
a tagged type <I>T</I>, then the invariant expression applies to all 
descendants of <I>T</I>.</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum"><a name="p9">9/4</a></div>
<div class="Normal" style="margin-bottom: 0.4em">If one or more invariant 
expressions apply to a nonabstract type <I>T</I>, then an invariant check 
is performed at the following places, on the specified object(s):<A NAME="I3636"></A><A NAME="I3637"></A></div>
<div class="paranum"><a name="p10">10/4</a></div>
<div class="Bulleted">After successful initialization of an object of 
type <I>T</I> by default (see <A HREF="RM-3-3-1.html">3.3.1</A>), the 
check is performed on the new object unless the partial view of <I>T</I> 
has unknown discriminants;</div>
<div class="paranum"><a name="p10.1">10.1/4</a></div>
<div class="Bulleted">After successful explicit initialization of the 
completion of a deferred constant with a part of type <I>T</I>, if the 
completion is inside the immediate scope of the full view of <I>T</I>, 
and the deferred constant is visible outside the immediate scope of <I>T</I>, 
the check is performed on the part(s) of type <I>T</I>;</div>
<div class="paranum"><a name="p11">11/3</a></div>
<div class="Bulleted">After successful conversion to type <I>T</I>, the 
check is performed on the result of the conversion;</div>
<div class="paranum"><a name="p12">12/3</a></div>
<div class="Bulleted">For a view conversion, outside the immediate scope 
of <I>T</I>, that converts from a descendant of <I>T</I> (including <I>T</I> 
itself) to an ancestor of type <I>T</I> (other than <I>T</I> itself), 
a check is performed on the part of the object that is of type <I>T</I>:</div>
<div class="paranum"><a name="p13">13/3</a></div>
<div class="Indented2NestedBulleted">after assigning to the view conversion; 
and</div>
<div class="paranum"><a name="p14">14/3</a></div>
<div class="Indented2NestedBulleted">after successful return from a call 
that passes the view conversion as an <B>in out</B> or <B>out</B> parameter. 
</div>
<div class="paranum"><a name="p15">15/4</a></div>
<div class="Bulleted">After a successful call on the Read or Input stream-oriented 
attribute of the type <I>T</I>, the check is performed on the object 
initialized by the attribute;</div>
<div class="paranum"><a name="p16">16/3</a></div>
<div class="Bulleted" style="margin-bottom: 0.3em">An invariant is checked 
upon successful return from a call on any subprogram or entry that:&nbsp;</div>
<div class="paranum"><a name="p17">17/4</a></div>
<div class="Indented2Bulleted">is declared within the immediate scope 
of type <I>T</I> (or by an instance of a generic unit, and the generic 
is declared within the immediate scope of type <I>T</I>),</div>
<div class="paranum"><a name="p18">18/4</a></div>
<div class="Indented2Bulleted"><SPAN STYLE="font-size: 80%"><I>This paragraph 
was deleted.</I></SPAN></div>
<div class="paranum"><a name="p19">19/4</a></div>
<div class="Indented2Bulleted" style="margin-bottom: 0.3em">and either:</div>
<div class="paranum"><a name="p19.1">19.1/4</a></div>
<div class="Indented3Bulleted">has a result with a part of type <I>T</I>, 
or</div>
<div class="paranum"><a name="p19.2">19.2/4</a></div>
<div class="Indented3Bulleted">has one or more <B>out</B> or <B>in out</B> 
parameters with a part of type <I>T</I>, or</div>
<div class="paranum"><a name="p19.3">19.3/4</a></div>
<div class="Indented3Bulleted">has an access-to-object parameter or result 
whose designated type has a part of type <I>T</I>, or</div>
<div class="paranum"><a name="p19.4">19.4/4</a></div>
<div class="Indented3Bulleted">is a procedure or entry that has an <B>in</B> 
parameter with a part of type <I>T</I>,</div>
<div class="paranum"><a name="p19.5">19.5/4</a></div>
<div class="Indented2Bulleted" style="margin-bottom: 0.3em">and either:</div>
<div class="paranum"><a name="p19.6">19.6/4</a></div>
<div class="Indented3Bulleted"><I>T</I> is a private type or a private 
extension and the subprogram or entry is visible outside the immediate 
scope of type <I>T</I> or overrides an inherited operation that is visible 
outside the immediate scope of <I>T</I>, or</div>
<div class="paranum"><a name="p19.7">19.7/4</a></div>
<div class="Indented3Bulleted"><I>T</I> is a record extension, and the 
subprogram or entry is a primitive operation visible outside the immediate 
scope of type <I>T</I> or overrides an inherited operation that is visible 
outside the immediate scope of <I>T</I>.&nbsp;</div>
<div class="paranum"><a name="p20">20/3</a></div>
<div class="Bulleted-NoPrefix">The check is performed on each such part 
of type <I>T</I>.</div>
<div class="paranum"><a name="p20.1">20.1/4</a></div>
<div class="Bulleted">For a view conversion to a class-wide type occurring 
within the immediate scope of <I>T</I>, from a specific type that is 
a descendant of <I>T</I> (including <I>T</I> itself), a check is performed 
on the part of the object that is of type <I>T</I>.</div>
<div class="paranum"><a name="p21">21/4</a></div>
<div class="Normal">&nbsp;If performing checks is required by the Type_Invariant 
or Type_Invariant'Class assertion policies (see <A HREF="RM-11-4-2.html">11.4.2</A>) 
in effect at the point of the corresponding aspect specification applicable 
to a given type, then the respective invariant expression is considered 
<I>enabled</I>.<A NAME="I3638"></A></div>
<div class="paranum"><a name="p22">22/3</a></div>
<div class="Normal">&nbsp;The invariant check consists of the evaluation of 
each enabled invariant expression that applies to <I>T</I>, on each of 
the objects specified above. If any of these evaluate to False, Assertions.Assertion_Error 
is raised at the point of the object initialization, conversion, or call.<A NAME="I3639"></A> 
If a given call requires more than one evaluation of an invariant expression, 
either for multiple objects of a single type or for multiple types with 
invariants, the evaluations are performed in an arbitrary order, and 
if one of them evaluates to False, it is not specified whether the others 
are evaluated. Any invariant check is performed prior to copying back 
any by-copy <B>in out</B> or <B>out</B> parameters. Invariant checks, 
any postcondition check, and any constraint or predicate checks associated 
with <B>in out</B> or <B>out</B> parameters are performed in an arbitrary 
order.</div>
<div class="paranum"><a name="p22.1">22.1/4</a></div>
<div class="Normal">&nbsp;&nbsp;&nbsp;For an invariant check on a value of type <I>T1</I> 
based on a class-wide invariant expression inherited from an ancestor 
type <I>T</I>, any operations within the invariant expression that were 
resolved as primitive operations of the (notional) formal derived type 
<I>NT</I> are bound to the corresponding operations of type <I>T1</I> 
in the evaluation of the invariant expression for the check on <I>T1</I>.</div>
<div class="paranum"><a name="p23">23/3</a></div>
<div class="Normal">&nbsp;The invariant checks performed on a call are determined 
by the subprogram or entry actually invoked, whether directly, as part 
of a dispatching call, or as part of a call through an access-to-subprogram 
value.</div>
<div class="NotesHeader">NOTES</div>
<div class="paranum"><a name="p24">24/3</a></div>
<div class="Notes">13&nbsp;&nbsp;For a call of a primitive subprogram 
of type <I>NT</I> that is inherited from type <I>T</I>, the specified 
checks of the specific invariants of both the types <I>NT</I> and <I>T</I> 
are performed. For a call of a primitive subprogram of type <I>NT</I> 
that is overridden for type <I>NT</I>, the specified checks of the specific 
invariants of only type <I>NT</I> are performed.</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-7-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-7-4.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
