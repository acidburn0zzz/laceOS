<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Deferred Constants</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    SPAN.insert2 {text-decoration: underline; color: rgb(0,102,0) }
    SPAN.delete2 {text-decoration: line-through; color: rgb(0,102,0) }
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 3.4em; margin-bottom: 0.6em}
    UL.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<DIV Style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-5.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<HR>
<H1>7.4 Deferred Constants</H1>
<DIV Class="paranum">1</DIV>
<DIV Class="Normal">[Deferred constant declarations may be used to declare 
constants in the visible part of a package, but with the value of the 
constant given in the private part. They may also be used to declare 
constants imported from other languages (see <A HREF="AA-B.html">Annex 
B</A>).]&nbsp;</DIV>

<H4 Class="centered">Legality Rules</H4>
<DIV Class="paranum">2</DIV>
<DIV Class="Normal">[<SPAN STYLE="font-size: 80%">{<I>deferred constant 
declaration</I>}</SPAN> <A NAME="I3611"></A>A <I>deferred constant declaration</I> 
is an <SPAN Class="swiss"><A HREF="AA-3-3-1.html#S0032">object_declaration</A></SPAN> 
with the reserved word <B>constant</B> but no initialization expression.] 
<SPAN STYLE="font-size: 80%">{<I>deferred constant</I>}</SPAN> <A NAME="I3612"></A>The 
constant declared by a deferred constant declaration is called a <I>deferred 
constant</I>. <SPAN STYLE="font-size: 80%">{<I>requires a completion 
(deferred constant declaration)</I> [partial]}</SPAN> <A NAME="I3613"></A>A 
deferred constant declaration requires a completion, which shall be a 
full constant declaration (called the <I>full declaration</I> of the 
deferred constant), or a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Import (see <A HREF="AA-B.html">Annex B</A>). <SPAN STYLE="font-size: 80%">{<I>full 
declaration</I>}</SPAN> <A NAME="I3614"></A></DIV>
<DIV Class="paranum">2.a</DIV>
<DIV Class="Annotations"><B>Proof:&nbsp;</B>The first sentence is redundant, 
as it is stated officially in <A HREF="AA-3-3-1.html">3.3.1</A>.&nbsp;</DIV>
<DIV Class="paranum">3</DIV>
<DIV Class="Normal" Style="margin-bottom: 0.4em">A deferred constant 
declaration that is completed by a full constant declaration shall occur 
immediately within the visible part of a <SPAN Class="swiss"><A HREF="AA-7-1.html#S0174">package_specification</A></SPAN>. 
For this case, the following additional rules apply to the corresponding 
full declaration:&nbsp;</DIV>
<DIV Class="paranum">4</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>The full declaration shall occur immediately 
within the private part of the same package;</LI></UL>
<DIV Class="paranum">5/2</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00385.TXT">AI95-00385-01</A></I>} 
The deferred and full constants shall have the same type<SPAN class="insert2">, 
or shall have statically matching anonymous access subtypes</SPAN>;&nbsp;</LI></UL>
<DIV Class="paranum">5.a/2</DIV>
<DIV Class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00385.TXT">AI95-00385-01</A></I>} 
This implies that both the deferred declaration and the full declaration 
have to have a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN><SPAN class="insert2">&nbsp;or <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN></SPAN> 
rather than an <SPAN Class="swiss"><A HREF="AA-3-6.html#S0051">array_type_definition</A></SPAN>, 
because each <SPAN Class="swiss"><A HREF="AA-3-6.html#S0051">array_type_definition</A></SPAN> 
would define a new type.&nbsp;</DIV>
<DIV Class="paranum">6/2</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00385.TXT">AI95-00385-01</A></I>} 
If the <SPAN class="insert2">deferred constant declaration includes a</SPAN><SPAN class="delete2">&nbsp;subtype 
defined by the</SPAN> <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
<SPAN class="insert2">that defines a</SPAN><SPAN class="delete2">&nbsp;in 
the deferred declaration is</SPAN> constrained<SPAN class="insert2">&nbsp;subtype</SPAN>, then the subtype defined by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
in the full declaration shall match it statically.[ On the other hand, 
if the subtype of the deferred constant is unconstrained, then the full 
declaration is still allowed to impose a constraint. The constant itself 
will be constrained, like all constants;]</LI></UL>
<DIV Class="paranum">7/2</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00231.TXT">AI95-00231-01</A></I>} 
If the deferred constant declaration includes the reserved word <B>aliased</B>, 
then the full declaration shall also<SPAN class="insert2">;</SPAN><SPAN class="delete2">.</SPAN> 
</LI></UL>
<DIV Class="paranum">7.a</DIV>
<DIV Class="Annotations"><B>Ramification:&nbsp;</B>On the other hand, the 
full constant can be aliased even if the deferred constant is not.&nbsp;</DIV>
<DIV Class="paranum">7.1/2</DIV>
<UL Class="Bulleted"><LI TYPE=DISC>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00231.TXT">AI95-00231-01</A></I>} 
<SPAN class="insert2">If the subtype of the deferred constant declaration 
excludes null, the subtype of the full declaration shall also exclude 
null.</SPAN>&nbsp;</LI></UL>
<DIV Class="paranum">7.a.1/2</DIV>
<DIV Class="Annotations"><SPAN class="insert2"><B>Ramification:&nbsp;</B>On 
the other hand, the full constant can exclude null even if the deferred 
constant does not. But that can only happen for a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>, 
as anonymous access types are required to statically match (which includes 
any <SPAN Class="swiss"><A HREF="AA-3-10.html#S0083">null_exclusion</A></SPAN>).</SPAN> 
</DIV>
<DIV Class="paranum">8</DIV>
<DIV Class="Normal">[A deferred constant declaration that is completed 
by a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Import need not appear in the visible part of a <SPAN Class="swiss"><A HREF="AA-7-1.html#S0174">package_specification</A></SPAN>, 
and has no full constant declaration.]</DIV>
<DIV Class="paranum">9/2</DIV>
<DIV Class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00256.TXT">AI95-00256-01</A></I>} 
The completion of a deferred constant declaration shall occur before 
the constant is frozen (see <SPAN class="insert2"><A HREF="AA-13-14.html">13.14</A></SPAN><SPAN class="delete2"><A HREF="AA-7-4.html">&nbsp;7.4</A></SPAN>).</DIV>

<H4 Class="centered">Dynamic Semantics</H4>
<DIV Class="paranum">10</DIV>
<DIV Class="Normal"><SPAN STYLE="font-size: 80%">{<I>elaboration (deferred 
constant declaration)</I> [partial]}</SPAN> <A NAME="I3615"></A>The elaboration 
of a deferred constant declaration elaborates the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
or (only allowed in the case of an imported constant) the <SPAN Class="swiss"><A HREF="AA-3-6.html#S0051">array_type_definition</A></SPAN>. 
</DIV>
<DIV Class="NotesHeader">NOTES</DIV>
<DIV Class="paranum">11</DIV>
<DIV Class="Notes">13&nbsp;&nbsp;The full constant declaration for a 
deferred constant that is of a given private type or private extension 
is not allowed before the corresponding <SPAN Class="swiss"><A HREF="AA-3-2-1.html#S0024">full_type_declaration</A></SPAN>. 
This is a consequence of the freezing rules for types (see <A HREF="AA-13-14.html">13.14</A>). 
</DIV>
<DIV Class="paranum">11.a</DIV>
<DIV Class="Annotations"><B>Ramification:&nbsp;</B>Multiple or single declarations 
are allowed for the deferred and the full declarations, provided that 
the equivalent single declarations would be allowed.</DIV>
<DIV Class="paranum">11.b</DIV>
<DIV Class="Annotations">Deferred constant declarations are useful for 
declaring constants of private views, and types with components of private 
views. They are also useful for declaring access-to-constant objects 
that designate variables declared in the private part of a package.&nbsp;</DIV>

<H4 Class="centered">Examples</H4>
<DIV Class="paranum">12</DIV>
<DIV Class="Normal" Style="margin-bottom: 0.4em"><I>Examples of deferred 
constant declarations:</I>&nbsp;</DIV>
<DIV Class="paranum">13</DIV>
<DIV Class="Examples">Null_Key&nbsp;:&nbsp;<B>constant</B>&nbsp;Key;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;see&nbsp;<A HREF="AA-7-3-1.html">7.3.1</A></I></SPAN></DIV>
<DIV Class="paranum">14</DIV>
<DIV Class="Examples">CPU_Identifier&nbsp;:&nbsp;<B>constant</B>&nbsp;String(1..8);<BR>
<B>pragma</B>&nbsp;Import(Assembler,&nbsp;CPU_Identifier,&nbsp;Link_Name&nbsp;=&gt;&nbsp;&quot;CPU_ID&quot;);<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;see&nbsp;<A HREF="AA-B-1.html">B.1</A></I></SPAN></DIV>

<H4 Class="centered">Extensions to Ada 83</H4>
<DIV Class="paranum">14.a</DIV>
<DIV Class="Annotations">{<I>extensions to Ada 83</I>} <A NAME="I3616"></A>In 
Ada 83, a deferred constant is required to be of a private type declared 
in the same visible part. This restriction is removed for Ada 95; deferred 
constants can be of any type.</DIV>
<DIV Class="paranum">14.b</DIV>
<DIV Class="Annotations">In Ada 83, a deferred constant declaration was 
not permitted to include a constraint, nor the reserved word <B>aliased</B>.</DIV>
<DIV Class="paranum">14.c</DIV>
<DIV Class="Annotations">In Ada 83, the rules required conformance of 
type marks; here we require static matching of subtypes if the deferred 
constant is constrained.</DIV>
<DIV Class="paranum">14.d</DIV>
<DIV Class="Annotations">A deferred constant declaration can be completed 
with a <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Import. Such a deferred constant declaration need not be within a <SPAN Class="swiss"><A HREF="AA-7-1.html#S0174">package_specification</A></SPAN>.</DIV>
<DIV Class="paranum">14.e</DIV>
<DIV Class="Annotations">The rules for too-early uses of deferred constants 
are modified in Ada 95 to allow more cases, and catch all errors at compile 
time. This change is necessary in order to allow deferred constants of 
a tagged type without violating the principle that for a dispatching 
call, there is always an implementation to dispatch to. It has the beneficial 
side-effect of catching some Ada-83-erroneous programs at compile time. 
The new rule fits in well with the new freezing-point rules. Furthermore, 
we are trying to convert undefined-value problems into bounded errors, 
and we were having trouble for the case of deferred constants. Furthermore, 
uninitialized deferred constants cause trouble for the shared variable 
/ tasking rules, since they are really variable, even though they purport 
to be constant. In Ada 95, they cannot be touched until they become constant.</DIV>
<DIV Class="paranum">14.f</DIV>
<DIV Class="Annotations">Note that we do not consider this change to 
be an upward incompatibility, because it merely changes an erroneous 
execution in Ada 83 into a compile-time error.</DIV>
<DIV Class="paranum">14.g</DIV>
<DIV Class="Annotations">The Ada 83 semantics are unclear in the case 
where the full view turns out to be an access type. It is a goal of the 
language design to prevent uninitialized access objects. One wonders 
if the implementation is required to initialize the deferred constant 
to null, and then initialize it (again!) to its real value. In Ada 95, 
the problem goes away.&nbsp;</DIV>

<H4 Class="centered">Wording Changes from Ada 83</H4>
<DIV Class="paranum">14.h</DIV>
<DIV Class="Annotations">Since deferred constants can now be of a nonprivate 
type, we have made this a stand-alone clause, rather than a subclause 
of <A HREF="AA-7-3.html">7.3</A>, &ldquo;<A HREF="AA-7-3.html">Private 
Types and Private Extensions</A>&rdquo;.</DIV>
<DIV Class="paranum">14.i</DIV>
<DIV Class="Annotations">Deferred constant declarations used to have 
their own syntax, but now they are simply a special case of <SPAN Class="swiss"><A HREF="AA-3-3-1.html#S0032">object_declaration</A></SPAN>s. 
</DIV>

<H4 Class="centered">Extensions to Ada 95</H4>
<DIV Class="paranum">14.j/2</DIV>
<DIV Class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00385.TXT">AI95-00385-01</A></I>} 
<SPAN class="insert2">{<I>extensions to Ada 95</I>} <A NAME="I3617"></A>Deferred 
constants were enhanced to allow the use of anonymous access types in 
them.</SPAN>&nbsp;</DIV>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<DIV Class="paranum">14.k/2</DIV>
<DIV Class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00231.TXT">AI95-00231-01</A></I>} 
<SPAN class="insert2">Added matching rules for subtypes that exclude 
null.</SPAN>&nbsp;</DIV>

<HR>
<DIV Style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-5.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="font-size: 125%">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
