<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Shared Variable Control</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.SyntaxIndented {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-bottom: 0.4em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><SPAN Style="font-size:200%; color: rgb(0,0,153)"><B>Ada Reference Manual</B></SPAN> &mdash; <A HREF="RM-TTL.html"><B>Legal Information</B></A></DIV>
<DIV Style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-5.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-7.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<HR>
<H1>C.6 Shared Variable Control</H1>
<DIV Class="paranum">1</DIV>
<DIV Class="Normal">This clause specifies representation pragmas that 
control the use of shared variables.&nbsp;</DIV>

<H4 Class="centered">Syntax</H4>
<DIV Class="paranum">2</DIV>
<DIV Class="SyntaxIndented" Style="margin-bottom: 0.2em">The form for 
pragmas Atomic, Volatile, Atomic_Components, and Volatile_Components 
is as follows:&nbsp;</DIV>
<DIV Class="paranum">3</DIV>
<DIV Class="SyntaxIndented">&nbsp;&nbsp;<B>pragma</B> <A NAME="I6720"></A><A NAME="I6721"></A>Atomic(<A NAME="I6722"></A><SPAN Class="swiss"><A HREF="RM-13-1.html#S0285">local_name</A></SPAN>);</DIV>
<DIV Class="paranum">4</DIV>
<DIV Class="SyntaxIndented">&nbsp;&nbsp;<B>pragma</B> <A NAME="I6723"></A><A NAME="I6724"></A>Volatile(<A NAME="I6725"></A><SPAN Class="swiss"><A HREF="RM-13-1.html#S0285">local_name</A></SPAN>);</DIV>
<DIV Class="paranum">5</DIV>
<DIV Class="SyntaxIndented">&nbsp;&nbsp;<B>pragma</B> <A NAME="I6726"></A><A NAME="I6727"></A>Atomic_Components(<I>array_</I><A NAME="I6728"></A><SPAN Class="swiss"><A HREF="RM-13-1.html#S0285">local_name</A></SPAN>);</DIV>
<DIV Class="paranum">6</DIV>
<DIV Class="SyntaxIndented">&nbsp;&nbsp;<B>pragma</B> <A NAME="I6729"></A><A NAME="I6730"></A>Volatile_Components(<I>array_</I><A NAME="I6731"></A><SPAN Class="swiss"><A HREF="RM-13-1.html#S0285">local_name</A></SPAN>);</DIV>
<DIV Class="paranum">7/2</DIV>
<DIV Class="Normal"><A NAME="I6732"></A>An <I>atomic</I> type is one 
to which a pragma Atomic applies. An <I>atomic</I> object (including 
a component) is one to which a pragma Atomic applies, or a component 
of an array to which a pragma Atomic_Components applies, or any object 
of an atomic type, other than objects obtained by evaluating a slice.</DIV>
<DIV Class="paranum">8</DIV>
<DIV Class="Normal"><A NAME="I6733"></A>A <I>volatile</I> type is one 
to which a pragma Volatile applies. A <I>volatile</I> object (including 
a component) is one to which a pragma Volatile applies, or a component 
of an array to which a pragma Volatile_Components applies, or any object 
of a volatile type. In addition, every atomic type or object is also 
defined to be volatile. Finally, if an object is volatile, then so are 
all of its subcomponents (the same does not apply to atomic).&nbsp;</DIV>

<H4 Class="centered">Name Resolution Rules</H4>
<DIV Class="paranum">9</DIV>
<DIV Class="Normal">The <SPAN Class="swiss"><A HREF="RM-13-1.html#S0285">local_name</A></SPAN> 
in an Atomic or Volatile pragma shall resolve to denote either an <SPAN Class="swiss"><A HREF="RM-3-3-1.html#S0032">object_declaration</A></SPAN>, 
a non-inherited <SPAN Class="swiss"><A HREF="RM-3-8.html#S0070">component_declaration</A></SPAN>, 
or a <SPAN Class="swiss"><A HREF="RM-3-2-1.html#S0024">full_type_declaration</A></SPAN>. 
The <I>array_</I><SPAN Class="swiss"><A HREF="RM-13-1.html#S0285">local_name</A></SPAN> 
in an Atomic_Components or Volatile_Components pragma shall resolve to 
denote the declaration of an array type or an array object of an anonymous 
type.</DIV>

<H4 Class="centered">Legality Rules</H4>
<DIV Class="paranum">10</DIV>
<DIV Class="Normal"><A NAME="I6734"></A>It is illegal to apply either 
an Atomic or Atomic_Components pragma to an object or type if the implementation 
cannot support the indivisible reads and updates required by the pragma 
(see below).</DIV>
<DIV Class="paranum">11</DIV>
<DIV Class="Normal">It is illegal to specify the Size attribute of an 
atomic object, the Component_Size attribute for an array type with atomic 
components, or the layout attributes of an atomic component, in a way 
that prevents the implementation from performing the required indivisible 
reads and updates.</DIV>
<DIV Class="paranum">12</DIV>
<DIV Class="Normal">If an atomic object is passed as a parameter, then 
the type of the formal parameter shall either be atomic or allow pass 
by copy (that is, not be a nonatomic by-reference type). If an atomic 
object is used as an actual for a generic formal object of mode <B>in 
out</B>, then the type of the generic formal object shall be atomic. 
If the <SPAN Class="swiss"><A HREF="RM-4-1.html#S0093">prefix</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="RM-4-1-4.html#S0100">attribute_reference</A></SPAN> 
for an Access attribute denotes an atomic object (including a component), 
then the designated type of the resulting access type shall be atomic. 
If an atomic type is used as an actual for a generic formal derived type, 
then the ancestor of the formal type shall be atomic or allow pass by 
copy. Corresponding rules apply to volatile objects and types.</DIV>
<DIV Class="paranum">13</DIV>
<DIV Class="Normal">If a pragma Volatile, Volatile_Components, Atomic, 
or Atomic_Components applies to a stand-alone constant object, then a 
pragma Import shall also apply to it.&nbsp;</DIV>

<H4 Class="centered">Static Semantics</H4>
<DIV Class="paranum">14</DIV>
<DIV Class="Normal"><A NAME="I6735"></A><A NAME="I6736"></A><A NAME="I6737"></A><A NAME="I6738"></A><A NAME="I6739"></A><A NAME="I6740"></A><A NAME="I6741"></A><A NAME="I6742"></A>These 
<SPAN Class="swiss"><A HREF="RM-2-8.html#S0019">pragma</A></SPAN>s are 
representation pragmas (see <A HREF="RM-13-1.html">13.1</A>).</DIV>

<H4 Class="centered">Dynamic Semantics</H4>
<DIV Class="paranum">15</DIV>
<DIV Class="Normal">For an atomic object (including an atomic component) 
all reads and updates of the object as a whole are indivisible.</DIV>
<DIV Class="paranum">16</DIV>
<DIV Class="Normal">For a volatile object all reads and updates of the 
object as a whole are performed directly to memory.&nbsp;</DIV>
<DIV Class="paranum">17</DIV>
<DIV Class="Normal"><A NAME="I6743"></A>Two actions are sequential (see 
<A HREF="RM-9-10.html">9.10</A>) if each is the read or update of the 
same atomic object.</DIV>
<DIV Class="paranum">18</DIV>
<DIV Class="Normal"><A NAME="I6744"></A>If a type is atomic or volatile 
and it is not a by-copy type, then the type is defined to be a by-reference 
type. If any subcomponent of a type is atomic or volatile, then the type 
is defined to be a by-reference type.</DIV>
<DIV Class="paranum">19</DIV>
<DIV Class="Normal">If an actual parameter is atomic or volatile, and 
the corresponding formal parameter is not, then the parameter is passed 
by copy.&nbsp;</DIV>

<H4 Class="centered">Implementation Requirements</H4>
<DIV Class="paranum">20</DIV>
<DIV Class="Normal"><A NAME="I6745"></A>The external effect of a program 
(see <A HREF="RM-1-1-3.html">1.1.3</A>) is defined to include each read 
and update of a volatile or atomic object. The implementation shall not 
generate any memory reads or updates of atomic or volatile objects other 
than those specified by the program.&nbsp;</DIV>
<DIV Class="paranum">21</DIV>
<DIV Class="Normal">If a pragma Pack applies to a type any of whose subcomponents 
are atomic, the implementation shall not pack the atomic subcomponents 
more tightly than that for which it can support indivisible reads and 
updates.&nbsp;</DIV>

<H4 Class="centered">Implementation Advice</H4>
<DIV Class="paranum">22/2</DIV>
<DIV Class="Normal">&nbsp;A load or store of a volatile object whose size 
is a multiple of System.Storage_Unit and whose alignment is nonzero, 
should be implemented by accessing exactly the bits of the object and 
no others.&nbsp;</DIV>
<DIV Class="paranum">23/2</DIV>
<DIV Class="Normal">&nbsp;A load or store of an atomic object should, where 
possible, be implemented by a single load or store instruction.&nbsp;</DIV>
<DIV Class="NotesHeader">NOTES</DIV>
<DIV Class="paranum">24</DIV>
<DIV Class="Notes">9&nbsp;&nbsp;An imported volatile or atomic constant 
behaves as a constant (i.e. read-only) with respect to other parts of 
the Ada program, but can still be modified by an &ldquo;external source.&rdquo;</DIV>

<HR>
<DIV Style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="RM-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-5.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="RM-C-7.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</DIV>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
